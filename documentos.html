<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EmailPro - Reconhecimento de Documentos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Biblioteca para PDF.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <!-- Biblioteca Tesseract.js para OCR -->
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
    <!-- Biblioteca para ler Excel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%);
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, #0284c7 0%, #0369a1 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(2, 132, 199, 0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            transition: all 0.3s ease;
        }
        
        .btn-success:hover {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(5, 150, 105, 0.3);
        }

        .sidebar-item {
            transition: all 0.2s ease;
        }
        
        .sidebar-item:hover {
            background-color: #f8fafc;
            border-left: 3px solid #0ea5e9;
        }
        
        .sidebar-item.active {
            background-color: #f1f5f9;
            border-left: 3px solid #0ea5e9;
            color: #0ea5e9;
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .modal-overlay {
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }
        
        .compact-input {
            padding-top: 0.5rem !important;
            padding-bottom: 0.5rem !important;
        }
        
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .custom-scrollbar {
            scrollbar-width: thin;
            scrollbar-color: #cbd5e1 #f1f5f9;
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 3px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        /* Estilos para o sistema de documentos */
        .document-preview {
            max-height: 400px;
            border: 2px dashed #d1d5db;
            border-radius: 0.5rem;
            background: #f9fafb;
        }

        .document-type-badge {
            padding: 0.25rem 0.5rem;
            border-radius: 0.375rem;
            font-size: 0.7rem;
            font-weight: 600;
        }

        .document-type-nota { background: #dbeafe; color: #1e40af; }
        .document-type-boleto { background: #f3e8ff; color: #7c3aed; }
        .document-type-contrato { background: #fef3c7; color: #d97706; }
        .document-type-holerite { background: #dcfce7; color: #166534; }
        .document-type-outros { background: #fce7f3; color: #be185d; }
        .document-type-extrato { background: #e0f2fe; color: #0369a1; }

        .extracted-data-item {
            border-left: 4px solid #0ea5e9;
            background: #f8fafc;
        }

        .confidence-high { color: #059669; }
        .confidence-medium { color: #d97706; }
        .confidence-low { color: #dc2626; }

        .grid-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .document-row:hover {
            background-color: #f8fafc;
        }

        .account-badge {
            padding: 0.15rem 0.4rem;
            border-radius: 0.25rem;
            font-size: 0.65rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .account-badge:hover {
            transform: scale(1.05);
        }

        .account-debito { background: #fee2e2; color: #dc2626; border: 1px solid #fecaca; }
        .account-credito { background: #d1fae5; color: #059669; border: 1px solid #a7f3d0; }

        .editable-field {
            border: 1px solid transparent;
            border-radius: 0.25rem;
            padding: 0.15rem 0.4rem;
            transition: all 0.2s ease;
            cursor: pointer;
            font-size: 0.75rem;
            min-width: 80px;
        }

        .editable-field:hover {
            border-color: #0ea5e9;
            background-color: #f0f9ff;
        }

        .editable-field:focus {
            border-color: #0ea5e9;
            background-color: white;
            outline: none;
            box-shadow: 0 0 0 2px rgba(14, 165, 233, 0.2);
        }

        .dropdown-options {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            background: white;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            z-index: 1000;
        }

        .dropdown-option {
            padding: 0.4rem 0.6rem;
            cursor: pointer;
            transition: background-color 0.2s;
            font-size: 0.75rem;
        }

        .dropdown-option:hover {
            background-color: #f3f4f6;
        }

        .dropdown-option.selected {
            background-color: #dbeafe;
            color: #1e40af;
        }

        /* Estilos para tabela compacta */
        .compact-table {
            font-size: 0.75rem;
        }

        .compact-table th {
            padding: 0.5rem 0.75rem;
            font-weight: 600;
        }

        .compact-table td {
            padding: 0.4rem 0.75rem;
            vertical-align: middle;
            position: relative;
        }

        .search-input {
            font-size: 0.75rem;
            padding: 0.4rem 0.6rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            width: 100%;
            margin-bottom: 0.5rem;
        }

        .search-input:focus {
            outline: none;
            border-color: #0ea5e9;
            box-shadow: 0 0 0 2px rgba(14, 165, 233, 0.2);
        }

        .historico-badge {
            padding: 0.15rem 0.4rem;
            border-radius: 0.25rem;
            font-size: 0.65rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            background: #e0e7ff;
            color: #3730a3;
            border: 1px solid #c7d2fe;
        }

        .historico-badge:hover {
            transform: scale(1.05);
            background: #dbeafe;
        }

        .historico-badge.empty {
            opacity: 0.6;
            background: #f3f4f6;
            color: #6b7280;
            border: 1px dashed #d1d5db;
        }

        .delete-btn {
            color: #dc2626;
            cursor: pointer;
            transition: all 0.2s ease;
            padding: 0.25rem;
            border-radius: 0.25rem;
        }

        .delete-btn:hover {
            background-color: #fee2e2;
            transform: scale(1.1);
        }

        .edit-btn {
            color: #0ea5e9;
            cursor: pointer;
            transition: all 0.2s ease;
            padding: 0.25rem;
            border-radius: 0.25rem;
            margin-right: 0.25rem;
        }

        .edit-btn:hover {
            background-color: #f0f9ff;
            transform: scale(1.1);
        }

        .small-modal {
            max-width: 400px;
            width: 90%;
        }

        /* Estilos para Toastify - CORRIGIDOS */
        #toast-container {
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            max-width: 400px;
        }

        .toast {
            background: rgba(255, 255, 255, 0.95) !important;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 0.75rem;
            padding: 0.75rem 1rem;
            box-shadow: 0 10px 25px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            animation: toastSlideIn 0.3s ease-out;
            display: flex;
            align-items: center;
            justify-content: space-between;
            min-width: 300px;
            max-width: 400px;
        }

        @keyframes toastSlideIn {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .toast-success {
            border-left: 4px solid #10b981;
            color: #065f46;
        }

        .toast-error {
            border-left: 4px solid #ef4444;
            color: #7f1d1d;
        }

        .toast-warning {
            border-left: 4px solid #f59e0b;
            color: #92400e;
        }

        .toast-info {
            border-left: 4px solid #3b82f6;
            color: #1e40af;
        }

        .toast-icon {
            margin-right: 0.75rem;
            font-size: 1.25rem;
        }

        .toast-close {
            background: none;
            border: none;
            color: inherit;
            cursor: pointer;
            opacity: 0.7;
            padding: 0.25rem;
            border-radius: 0.25rem;
            transition: all 0.2s ease;
            margin-left: 0.75rem;
        }

        .toast-close:hover {
            opacity: 1;
            background: rgba(0, 0, 0, 0.1);
        }

        /* Estilos para área de upload compacta */
        .compact-upload-area {
            padding: 1.5rem !important;
        }

        /* Estilos para o ícone de informação */
        .info-icon {
            background: #3b82f6;
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .info-icon:hover {
            background: #2563eb;
            transform: scale(1.1);
        }

        /* Estilos para transações de extrato */
        .transacao-entrada { background: #f0fdf4; }
        .transacao-saida { background: #fef2f2; }
        .transacao-row:hover { background: #f8fafc; }

        /* Estilos para filtros */
        .filter-badge {
            padding: 0.2rem 0.5rem;
            border-radius: 0.375rem;
            font-size: 0.65rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            background: #e5e7eb;
            color: #374151;
            border: 1px solid #d1d5db;
        }

        .filter-badge.active {
            background: #3b82f6;
            color: white;
            border-color: #2563eb;
        }

        .filter-badge:hover {
            transform: scale(1.05);
        }

        /* Estilos para botão de exclusão em massa */
        .btn-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            transition: all 0.3s ease;
        }
        
        .btn-danger:hover {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3);
        }

        /* AJUSTADO: Estilos para tabela com scroll vertical - altura reduzida */
        .table-container {
            max-height: 50vh;
            overflow-y: auto;
        }

        /* Estilos para modal de seleção de conta */
        .conta-modal {
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
        }

        /* NOVO: Estilo para linha única nas contas */
        .conta-line {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.75rem;
        }

        .conta-codigo {
            font-family: monospace;
            font-weight: bold;
            color: #1e40af;
            min-width: 80px;
        }

        .conta-numero {
            font-family: monospace;
            color: #374151;
            min-width: 120px;
        }

        .conta-descricao {
            color: #6b7280;
            flex: 1;
        }
    </style>
</head>
<body class="min-h-screen p-3">
    <div id="app" class="max-w-7xl mx-auto">
        <div class="text-center py-20">
            <div class="bg-white rounded-2xl p-8 inline-block">
                <i class="fas fa-spinner fa-spin text-3xl text-blue-600 mb-4"></i>
                <p class="text-gray-600">Carregando Sistema de Documentos...</p>
            </div>
        </div>
    </div>

    <div id="toast-container"></div>

    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback, useMemo } = React;

        // Configuração do PDF.js
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';

        // Sistema de Reconhecimento de Documentos
        const DocumentRecognition = {
            patterns: {
                cpf: /(\d{3}\.\d{3}\.\d{3}-\d{2})|(\d{11})/g,
                cnpj: /(\d{2}\.\d{3}\.\d{3}\/\d{4}-\d{2})|(\d{14})/g,
                valor: /R\$\s?[\d.,]+|\$\s?[\d.,]+|EUR\s?[\d.,]+|\b[\d.,]+\s?(reais|real)\b/gi,
                data: /(\d{1,2}\/\d{1,2}\/\d{4})|(\d{4}-\d{2}-\d{2})|(\d{1,2}\/\d{1,2}\/\d{2})/g,
                vencimento: /(vencimento|venc\.|vcto)[:\s]*(\d{1,2}\/\d{1,2}\/\d{4})/gi,
                beneficiario: /(beneficiário|beneficiario|favorecido|fornecedor|emitente)[:\s]*([A-Za-zÀ-ÿ\s&]+)/gi,
                pagador: /(pagador|cliente|destinatário)[:\s]*([A-Za-zÀ-ÿ\s&]+)/gi
            },

            documentKeywords: {
                nota_fiscal: [
                    'nota fiscal', 'nf-e', 'nfe', 'danfe', 'destinatário', 'emitente',
                    'valor total', 'icms', 'iss', 'chave acesso', 'mercadoria', 'produto'
                ],
                boleto: [
                    'boleto', 'código barras', 'linha digitável', 'vencimento',
                    'valor documento', 'beneficiário', 'pagador', 'banco'
                ],
                contrato: [
                    'contrato', 'cláusula', 'vigência', 'partes', 'objeto',
                    'prazo', 'rescisão', 'contratante', 'contratada'
                ],
                holerite: [
                    'holerite', 'contracheque', 'salário', 'proventos', 'descontos',
                    'inss', 'irrf', 'fgts', 'base cálculo', 'recibo pagamento'
                ],
                extrato: [
                    'extrato', 'saldo do dia', 'conta corrente', 'internet banking',
                    'pix recebido', 'pix enviado', 'pagamento', 'transferência',
                    'ted', 'aplicacao', 'resgate', 'tarifa', 'debito', 'credito'
                ]
            },

            identifyDocumentType: function(text) {
                const lowerText = text.toLowerCase();
                let scores = {};

                Object.keys(this.documentKeywords).forEach(docType => {
                    scores[docType] = this.documentKeywords[docType].reduce((score, keyword) => {
                        return score + (lowerText.includes(keyword) ? 1 : 0);
                    }, 0);
                });

                const maxScore = Math.max(...Object.values(scores));
                if (maxScore === 0) return 'outros';

                return Object.keys(scores).find(key => scores[key] === maxScore);
            },

            extractDocumentData: function(text) {
                const data = {
                    tipoDocumento: '',
                    cpfCnpj: '',
                    valor: '',
                    dataVencimento: '',
                    beneficiario: '',
                    pagador: '',
                    contaDebito: '',
                    contaCredito: '',
                    historico: '',
                    confianca: 0,
                    textoExtraido: text.substring(0, 500) + (text.length > 500 ? '...' : '')
                };

                data.tipoDocumento = this.identifyDocumentType(text);

                const cpfs = text.match(this.patterns.cpf) || [];
                const cnpjs = text.match(this.patterns.cnpj) || [];
                
                if (cnpjs.length > 0) {
                    data.cpfCnpj = cnpjs[0];
                } else if (cpfs.length > 0) {
                    data.cpfCnpj = cpfs[0];
                }

                const valores = text.match(this.patterns.valor) || [];
                if (valores.length > 0) {
                    data.valor = valores[0];
                }

                const vencimentos = text.match(this.patterns.vencimento);
                if (vencimentos && vencimentos.length > 0) {
                    const dataMatch = vencimentos[0].match(this.patterns.data);
                    if (dataMatch && dataMatch.length > 0) {
                        data.dataVencimento = dataMatch[0];
                    }
                } else {
                    const datas = text.match(this.patterns.data) || [];
                    if (datas.length > 0) {
                        data.dataVencimento = datas[0];
                    }
                }

                const beneficiarios = text.match(this.patterns.beneficiario);
                if (beneficiarios && beneficiarios.length > 0) {
                    data.beneficiario = beneficiarios[0].replace(/(beneficiário|beneficiario|favorecido|fornecedor|emitente)[:\s]*/gi, '').trim();
                }

                const pagadores = text.match(this.patterns.pagador);
                if (pagadores && pagadores.length > 0) {
                    data.pagador = pagadores[0].replace(/(pagador|cliente|destinatário)[:\s]*/gi, '').trim();
                }

                data.historico = this.gerarHistoricoAutomatico(data.tipoDocumento, data.beneficiario);
                data.confianca = this.calculateConfidence(data);

                return data;
            },

            gerarHistoricoAutomatico: function(tipoDocumento, beneficiario) {
                const historicos = {
                    'nota_fiscal': `NF - ${beneficiario || 'Fornecedor'}`,
                    'boleto': `Boleto - ${beneficiario || 'Cobrança'}`,
                    'contrato': `Contrato - ${beneficiario || 'Parte Contratada'}`,
                    'holerite': 'Folha de Pagamento',
                    'extrato': 'Transação Bancária',
                    'outros': 'Documento Diverso'
                };
                return historicos[tipoDocumento] || 'Lançamento Contábil';
            },

            calculateConfidence: function(data) {
                let score = 0;
                let totalFields = 6;

                if (data.tipoDocumento && data.tipoDocumento !== 'outros') score += 1;
                if (data.cpfCnpj) score += 1;
                if (data.valor) score += 1;
                if (data.dataVencimento) score += 1;
                if (data.beneficiario) score += 1;
                if (data.pagador) score += 1;

                return (score / totalFields) * 100;
            }
        };

        // Processador Específico para Extratos
        const ExtratoProcessor = {
            processarTextoExtrato: function(text) {
                const linhas = text.split('\n').filter(linha => linha.trim().length > 0);
                const transacoes = [];
                
                linhas.forEach(linha => {
                    if (this.isLinhaTransacao(linha)) {
                        const transacao = this.extrairTransacao(linha);
                        if (transacao && this.deveIncluirTransacao(transacao)) {
                            transacoes.push(transacao);
                        }
                    }
                });
                
                return {
                    transacoes: transacoes,
                    totalTransacoes: transacoes.length,
                    periodo: this.extrairPeriodo(transacoes)
                };
            },
            
            isLinhaTransacao: function(linha) {
                return /^\d{2}\/\d{2}\/\d{4}/.test(linha.trim());
            },
            
            extrairTransacao: function(linha) {
                try {
                    const padrao = /^(\d{2}\/\d{2}\/\d{4})\s+(.*?)\s+(-?R\$\s?[\d.,]+)/;
                    const match = linha.match(padrao);
                    
                    if (!match) return null;
                    
                    const [, data, historico, valor] = match;
                    
                    const cpfCnpjMatch = historico.match(/(\d{11}|\d{14})/);
                    const cpfCnpj = cpfCnpjMatch ? cpfCnpjMatch[0] : '';
                    
                    const tipo = valor.includes('-') ? 'saida' : 'entrada';
                    const valorNumerico = valor.replace(/[^\d,-]/g, '').replace(',', '.');
                    const valorAbsoluto = Math.abs(parseFloat(valorNumerico));
                    
                    return {
                        data,
                        historico: historico.trim(),
                        valor: valor.trim(),
                        valorNumerico: valorAbsoluto,
                        cpfCnpj,
                        tipo,
                        linhaOriginal: linha
                    };
                } catch (error) {
                    console.error('Erro ao processar linha:', linha, error);
                    return null;
                }
            },

            deveIncluirTransacao: function(transacao) {
                // Excluir transações com "Saldo do dia" e valor 0,00
                if (transacao.historico.toLowerCase().includes('saldo do dia')) {
                    return false;
                }
                
                // Excluir transações com valor 0,00
                if (transacao.valorNumerico === 0) {
                    return false;
                }
                
                return true;
            },
            
            extrairPeriodo: function(transacoes) {
                if (transacoes.length === 0) return '';
                const datas = transacoes.map(t => t.data);
                const primeiraData = datas[datas.length - 1];
                const ultimaData = datas[0];
                return `${primeiraData} a ${ultimaData}`;
            },
            
            classificarTransacao: function(historico) {
                const histLower = historico.toLowerCase();
                if (histLower.includes('pix recebido')) return 'Recebimento Pix';
                if (histLower.includes('pix enviado')) return 'Pagamento Pix';
                if (histLower.includes('pagamento')) return 'Pagamento';
                if (histLower.includes('tarifa')) return 'Tarifa Bancária';
                if (histLower.includes('aplicacao')) return 'Aplicação Financeira';
                if (histLower.includes('resgate')) return 'Resgate Financeiro';
                if (histLower.includes('ted')) return 'Transferência TED';
                if (histLower.includes('debito')) return 'Débito Automático';
                if (histLower.includes('credito')) return 'Crédito Automático';
                return 'Outras Transações';
            }
        };

        // Sistema de Processamento de PDF e OCR
        const PDFProcessor = {
            pdfToImages: async (pdfFile) => {
                try {
                    const arrayBuffer = await pdfFile.arrayBuffer();
                    const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
                    const images = [];

                    for (let pageNum = 1; pageNum <= pdf.numPages; pageNum++) {
                        const page = await pdf.getPage(pageNum);
                        const viewport = page.getViewport({ scale: 2.0 });

                        const canvas = document.createElement('canvas');
                        const context = canvas.getContext('2d');
                        canvas.width = viewport.width;
                        canvas.height = viewport.height;

                        await page.render({
                            canvasContext: context,
                            viewport: viewport
                        }).promise;

                        const imageData = canvas.toDataURL('image/png');
                        images.push(imageData);
                    }

                    return images;
                } catch (error) {
                    console.error('Erro ao converter PDF para imagens:', error);
                    throw new Error('Falha ao processar PDF');
                }
            },

            performOCR: async (images) => {
                try {
                    let fullText = '';

                    for (let i = 0; i < images.length; i++) {
                        const result = await Tesseract.recognize(
                            images[i],
                            'por+eng',
                            {
                                logger: m => console.log('Progresso OCR:', m)
                            }
                        );

                        fullText += result.data.text + '\n\n';
                    }

                    return fullText;
                } catch (error) {
                    console.error('Erro no OCR:', error);
                    throw new Error('Falha no reconhecimento de texto');
                }
            },

            processFile: async (file) => {
                try {
                    let text = '';

                    if (file.type === 'application/pdf') {
                        const images = await PDFProcessor.pdfToImages(file);
                        text = await PDFProcessor.performOCR(images);
                    } else if (file.type.startsWith('image/')) {
                        text = await PDFProcessor.performOCR([URL.createObjectURL(file)]);
                    } else {
                        throw new Error('Tipo de arquivo não suportado');
                    }

                    return text;
                } catch (error) {
                    throw error;
                }
            }
        };

        // Gerador de arquivo CTBIL
        const CTBILGenerator = {
            generateCTBIL: (documentos, config) => {
                let ctbilContent = '';
                let numeroLancamento = 1;
                
                documentos.forEach((doc) => {
                    if (doc.contaDebito && doc.contaCredito && doc.valor) {
                        const numeroLancFormatado = numeroLancamento.toString().padStart(8, '0');
                        const dataLancamento = config.dataFinal.replace(/-/g, '');
                        const valorFormatado = CTBILGenerator.formatValue(doc.valor);
                        const historicoFormatado = (doc.historico || 'Lançamento automático').substring(0, 50).padEnd(50, ' ');
                        const contaDebitoFormatada = doc.contaDebito.padEnd(17, ' ');
                        const contaCreditoFormatada = doc.contaCredito.padEnd(17, ' ');
                        const hp = '   ';
                        const filialDebito = (config.filialDebito || '00').padEnd(2, ' ');
                        const filialCredito = (config.filialCredito || '00').padEnd(2, ' ');
                        
                        const lancamentoDebito = 
                            dataLancamento +
                            numeroLancFormatado +
                            contaDebitoFormatada +
                            contaCreditoFormatada +
                            valorFormatado +
                            hp +
                            historicoFormatado +
                            filialDebito +
                            filialCredito;
                        
                        const lancamentoCredito = 
                            dataLancamento +
                            numeroLancFormatado +
                            contaCreditoFormatada +
                            contaDebitoFormatada +
                            valorFormatado +
                            hp +
                            historicoFormatado +
                            filialCredito +
                            filialDebito;
                        
                        ctbilContent += lancamentoDebito + '\r\n';
                        ctbilContent += lancamentoCredito + '\r\n';
                        
                        numeroLancamento++;
                    }
                });
                
                return ctbilContent;
            },

            formatValue: (valorStr) => {
                try {
                    const cleanValue = valorStr.replace(/[^\d,]/g, '').replace(',', '.');
                    const valor = parseFloat(cleanValue) || 0;
                    
                    if (isNaN(valor)) {
                        return ' '.repeat(14);
                    }
                    
                    const valorFormatado = valor.toFixed(2);
                    const [parteInteira, parteDecimal] = valorFormatado.split('.');
                    const valorCompleto = parteInteira + '.' + parteDecimal;
                    
                    if (valorCompleto.length > 14) {
                        return valorCompleto.substring(0, 14).padStart(14, ' ');
                    }
                    
                    return valorCompleto.padStart(14, ' ');
                    
                } catch (error) {
                    return ' '.repeat(14);
                }
            },

            validateCTBIL: (content) => {
                const lines = content.split('\r\n').filter(line => line.trim() !== '');
                
                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i];
                    if (line.length !== 121) {
                        return false;
                    }
                    
                    const valor = line.substring(50, 64);
                    if (!/^ *\d*\.?\d* *$/.test(valor)) {
                        return false;
                    }
                }
                
                return true;
            },

            downloadCTBIL: (content, filename) => {
                try {
                    if (!CTBILGenerator.validateCTBIL(content)) {
                        ToastManager.show('Erro na validação do arquivo CTBIL', 'error');
                        return false;
                    }
                    
                    const encoder = new TextEncoder('iso-8859-1');
                    const data = encoder.encode(content);
                    const blob = new Blob([data], { type: 'text/plain;charset=iso-8859-1' });
                    
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = filename;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    return true;
                } catch (error) {
                    console.error('Erro ao baixar CTBIL:', error);
                    ToastManager.show('Erro ao gerar arquivo CTBIL', 'error');
                    return false;
                }
            }
        };

        // ToastManager
        const ToastManager = {
            show: (message, type = 'info', duration = 3000) => {
                const container = document.getElementById('toast-container');
                const toast = document.createElement('div');
                
                const typeConfigs = {
                    success: { icon: 'fa-check-circle', class: 'toast-success' },
                    error: { icon: 'fa-exclamation-circle', class: 'toast-error' },
                    warning: { icon: 'fa-exclamation-triangle', class: 'toast-warning' },
                    info: { icon: 'fa-info-circle', class: 'toast-info' }
                };

                const config = typeConfigs[type] || typeConfigs.info;

                toast.className = `toast ${config.class}`;
                toast.innerHTML = `
                    <div class="flex items-center">
                        <i class="fas ${config.icon} toast-icon"></i>
                        <span class="text-sm font-medium">${message}</span>
                    </div>
                    <button class="toast-close">
                        <i class="fas fa-times text-sm"></i>
                    </button>
                `;

                const closeBtn = toast.querySelector('.toast-close');
                closeBtn.addEventListener('click', () => {
                    toast.style.animation = 'toastSlideIn 0.3s ease-out reverse';
                    setTimeout(() => {
                        if (toast.parentElement) {
                            toast.remove();
                        }
                    }, 250);
                });

                container.appendChild(toast);

                setTimeout(() => {
                    if (toast.parentElement) {
                        toast.style.animation = 'toastSlideIn 0.3s ease-out reverse';
                        setTimeout(() => {
                            if (toast.parentElement) {
                                toast.remove();
                            }
                        }, 250);
                    }
                }, duration);
            }
        };

        function App() {
            const [currentView, setCurrentView] = useState('documents');
            const [isLoading, setIsLoading] = useState(true);
            
            // Estados para o sistema de documentos
            const [isProcessingOCR, setIsProcessingOCR] = useState(false);
            const [ocrProgress, setOcrProgress] = useState(0);
            const [documentos, setDocumentos] = useState([]);
            const [showImportModal, setShowImportModal] = useState(false);
            const [planoContas, setPlanoContas] = useState([]);
            const [historicoContas, setHistoricoContas] = useState([]);
            const [showHistoricoModal, setShowHistoricoModal] = useState(false);
            const [showEditModal, setShowEditModal] = useState(false);
            const [mostrarApenasAnaliticas, setMostrarApenasAnaliticas] = useState(false);
            const [showCTBILModal, setShowCTBILModal] = useState(false);
            const [showInfoModal, setShowInfoModal] = useState(false);

            // Estados para modal de seleção de conta
            const [showContaModal, setShowContaModal] = useState(false);
            const [contaModalType, setContaModalType] = useState(''); // 'debito' ou 'credito'
            const [contaModalDocumento, setContaModalDocumento] = useState(null);

            // Estados para edição em linha
            const [editingCell, setEditingCell] = useState(null);
            const [editValue, setEditValue] = useState('');
            const [showDropdown, setShowDropdown] = useState(false);
            const [dropdownPosition, setDropdownPosition] = useState({ x: 0, y: 0 });
            const [dropdownType, setDropdownType] = useState('');
            const [searchTerm, setSearchTerm] = useState('');

            // Estados para edição de históricos e contas
            const [editingHistorico, setEditingHistorico] = useState(null);
            const [editingConta, setEditingConta] = useState(null);
            const [editHistoricoValue, setEditHistoricoValue] = useState('');
            const [editContaValue, setEditContaValue] = useState({ codigoReduzido: '', conta: '', descricao: '' });

            // Estados para CTBIL
            const [configCTBIL, setConfigCTBIL] = useState({
                codigoEmpresa: 'EMPRESA TESTE LTDA',
                numeroLote: '000001',
                dataFinal: new Date().toISOString().split('T')[0],
                filialDebito: '00',
                filialCredito: '00',
                centroCusto: '0000'
            });

            // Estados para processamento de extratos
            const [showExtratoModal, setShowExtratoModal] = useState(false);
            const [extratoProcessado, setExtratoProcessado] = useState(null);
            const [contaBancariaSelecionada, setContaBancariaSelecionada] = useState('');

            // Estados para filtros
            const [filtroTipo, setFiltroTipo] = useState('todos');
            const [filtroContas, setFiltroContas] = useState('todos');
            const [filtroHistorico, setFiltroHistorico] = useState('');

            // Estados para automação de históricos
            const [showAutomacaoModal, setShowAutomacaoModal] = useState(false);
            const [historicoParaAutomacao, setHistoricoParaAutomacao] = useState(null);
            const [contasSugeridas, setContasSugeridas] = useState({ debito: '', credito: '' });

            // Estados para exclusão em massa
            const [showDeleteModal, setShowDeleteModal] = useState(false);
            const [deleteFilters, setDeleteFilters] = useState({
                tipo: '',
                historico: '',
                dataInicio: '',
                dataFim: ''
            });

            // Referência para o container do dropdown
            const dropdownRef = useRef(null);

            // Gerar próximo código auto incremento para históricos
            const getProximoCodigo = useCallback(() => {
                if (historicoContas.length === 0) return '001';
                const ultimoCodigo = Math.max(...historicoContas.map(h => parseInt(h.codigo)));
                return String(ultimoCodigo + 1).padStart(3, '0');
            }, [historicoContas]);

            // Função para verificar se uma conta é analítica
            const isContaAnalitica = useCallback((conta) => {
                const pattern = /^\d\.\d\.\d\.\d{2}\.\d{3}$/;
                return pattern.test(conta);
            }, []);

            // Carregar dados do localStorage
            useEffect(() => {
                const loadData = () => {
                    try {
                        const savedDocuments = localStorage.getItem('documentosProcessados');
                        const savedPlanoContas = localStorage.getItem('planoContas');
                        const savedHistoricoContas = localStorage.getItem('historicoContas');
                        
                        if (savedDocuments) {
                            setDocumentos(JSON.parse(savedDocuments));
                        }
                        if (savedPlanoContas) {
                            setPlanoContas(JSON.parse(savedPlanoContas));
                        }
                        if (savedHistoricoContas) {
                            setHistoricoContas(JSON.parse(savedHistoricoContas));
                        }
                        setIsLoading(false);
                    } catch (error) {
                        console.error('Erro ao carregar dados:', error);
                        setIsLoading(false);
                    }
                };
                loadData();
            }, []);

            // Salvar dados no localStorage
            useEffect(() => {
                if (documentos.length > 0) {
                    localStorage.setItem('documentosProcessados', JSON.stringify(documentos));
                }
            }, [documentos]);

            useEffect(() => {
                if (planoContas.length > 0) {
                    localStorage.setItem('planoContas', JSON.stringify(planoContas));
                }
            }, [planoContas]);

            useEffect(() => {
                if (historicoContas.length > 0) {
                    localStorage.setItem('historicoContas', JSON.stringify(historicoContas));
                }
            }, [historicoContas]);

            // Fechar dropdown ao clicar fora
            useEffect(() => {
                const handleClickOutside = (event) => {
                    if (dropdownRef.current && !dropdownRef.current.contains(event.target)) {
                        setShowDropdown(false);
                        setEditingCell(null);
                        setSearchTerm('');
                    }
                };

                document.addEventListener('mousedown', handleClickOutside);
                return () => document.removeEventListener('mousedown', handleClickOutside);
            }, []);

            // Filtrar documentos baseado nos filtros ativos
            const documentosFiltrados = useMemo(() => {
                let filtrados = documentos;

                // Filtro por tipo
                if (filtroTipo !== 'todos') {
                    filtrados = filtrados.filter(doc => doc.tipoDocumento === filtroTipo);
                }

                // Filtro por contas
                if (filtroContas === 'sem_debito') {
                    filtrados = filtrados.filter(doc => !doc.contaDebito);
                } else if (filtroContas === 'sem_credito') {
                    filtrados = filtrados.filter(doc => !doc.contaCredito);
                } else if (filtroContas === 'sem_contas') {
                    filtrados = filtrados.filter(doc => !doc.contaDebito || !doc.contaCredito);
                } else if (filtroContas === 'completos') {
                    filtrados = filtrados.filter(doc => doc.contaDebito && doc.contaCredito);
                }

                // Filtro por histórico
                if (filtroHistorico) {
                    filtrados = filtrados.filter(doc => 
                        doc.historico && doc.historico.toLowerCase().includes(filtroHistorico.toLowerCase())
                    );
                }

                return filtrados;
            }, [documentos, filtroTipo, filtroContas, filtroHistorico]);

            // Obter históricos únicos para filtro
            const historicosUnicos = useMemo(() => {
                const historicos = documentos
                    .map(doc => doc.historico)
                    .filter(historico => historico && historico.trim() !== '');
                return [...new Set(historicos)].sort();
            }, [documentos]);

            // Processar documento com OCR
            const processDocumentWithOCR = async (file) => {
                try {
                    setIsProcessingOCR(true);
                    setOcrProgress(0);

                    ToastManager.show('Iniciando análise do documento...', 'info');

                    const progressInterval = setInterval(() => {
                        setOcrProgress(prev => {
                            if (prev >= 90) {
                                clearInterval(progressInterval);
                                return prev;
                            }
                            return prev + 10;
                        });
                    }, 500);

                    const text = await PDFProcessor.processFile(file);
                    
                    clearInterval(progressInterval);
                    setOcrProgress(100);

                    // VERIFICAR SE É EXTRATO
                    const tipoDocumento = DocumentRecognition.identifyDocumentType(text);
                    
                    if (tipoDocumento === 'extrato') {
                        const extratoData = ExtratoProcessor.processarTextoExtrato(text);
                        setExtratoProcessado(extratoData);
                        setShowExtratoModal(true);
                        ToastManager.show('Extrato bancário detectado! Configure a importação.', 'info');
                        return;
                    }

                    // Processamento normal para outros documentos
                    const documentData = DocumentRecognition.extractDocumentData(text);
                    
                    const documentoCompleto = {
                        id: Date.now().toString(),
                        fileName: file.name,
                        fileSize: file.size,
                        processedAt: new Date().toISOString(),
                        ...documentData
                    };

                    setDocumentos(prev => [documentoCompleto, ...prev]);
                    ToastManager.show(`Documento processado com ${documentData.confianca.toFixed(1)}% de confiança`, 'success');

                } catch (error) {
                    console.error('Erro no processamento OCR:', error);
                    ToastManager.show(`Erro na análise do documento: ${error.message}`, 'error');
                } finally {
                    setIsProcessingOCR(false);
                    setOcrProgress(0);
                }
            };

            // Função para abrir modal de seleção de conta
            const abrirModalConta = (tipo, documento) => {
                setContaModalType(tipo);
                setContaModalDocumento(documento);
                setShowContaModal(true);
                setSearchTerm('');
            };

            // Função para selecionar conta no modal
            const selecionarContaModal = (conta) => {
                if (contaModalDocumento && contaModalType) {
                    const campo = contaModalType === 'debito' ? 'contaDebito' : 'contaCredito';
                    setDocumentos(prev => prev.map(doc => 
                        doc.id === contaModalDocumento.id
                            ? { ...doc, [campo]: conta.conta }
                            : doc
                    ));
                    ToastManager.show(`Conta ${contaModalType === 'debito' ? 'débito' : 'crédito'} definida com sucesso`, 'success');
                }
                setShowContaModal(false);
                setContaModalType('');
                setContaModalDocumento(null);
            };

            // Importar extrato processado
            const importarExtrato = () => {
                if (!extratoProcessado || !contaBancariaSelecionada) return;

                // Verificar se já existem transações importadas
                const transacoesExistentes = documentos.filter(doc => doc.origemExtrato);
                const novasTransacoes = extratoProcessado.transacoes.filter(novaTransacao => 
                    !transacoesExistentes.some(existente => 
                        existente.dataVencimento === novaTransacao.data && 
                        existente.historico?.includes(novaTransacao.historico.substring(0, 30)) &&
                        existente.valor === novaTransacao.valor
                    )
                );

                const duplicatas = extratoProcessado.transacoes.length - novasTransacoes.length;
                
                let transacoesParaAdicionar = novasTransacoes;
                
                if (duplicatas > 0) {
                    const resposta = window.confirm(
                        `Foram encontradas ${duplicatas} transações que já existem no sistema.\n\n` +
                        `Clique em "OK" para SOBREPOR as transações existentes.\n` +
                        `Clique em "Cancelar" para ACRESCENTAR apenas as novas transações.`
                    );

                    if (resposta) {
                        // Sobrescrever: remover transações existentes e adicionar todas as novas
                        setDocumentos(prev => prev.filter(doc => !doc.origemExtrato));
                        transacoesParaAdicionar = extratoProcessado.transacoes;
                    }
                }

                const novosDocumentos = transacoesParaAdicionar.map((transacao, index) => {
                    const classificacao = ExtratoProcessor.classificarTransacao(transacao.historico);
                    
                    return {
                        id: `extrato_${Date.now()}_${index}`,
                        fileName: `Extrato_${transacao.data}`,
                        fileSize: 0,
                        processedAt: new Date().toISOString(),
                        tipoDocumento: 'extrato',
                        cpfCnpj: transacao.cpfCnpj,
                        valor: transacao.valor,
                        dataVencimento: transacao.data,
                        beneficiario: transacao.tipo === 'entrada' ? 'Cliente/Diversos' : classificacao,
                        pagador: transacao.tipo === 'saida' ? 'Cliente/Diversos' : classificacao,
                        contaDebito: transacao.tipo === 'entrada' ? contaBancariaSelecionada : '',
                        contaCredito: transacao.tipo === 'saida' ? contaBancariaSelecionada : '',
                        historico: `${classificacao} - ${transacao.historico.substring(0, 30)}...`,
                        confianca: 90,
                        textoExtraido: transacao.linhaOriginal,
                        origemExtrato: true
                    };
                });

                setDocumentos(prev => [...novosDocumentos, ...prev]);
                
                ToastManager.show(
                    `${transacoesParaAdicionar.length} transações importadas com sucesso!` +
                    (duplicatas > 0 ? ` (${duplicatas} ${duplicatas === 1 ? 'duplicata' : 'duplicatas'} ${duplicatas === transacoesParaAdicionar.length ? 'sobrescritas' : 'ignoradas'})` : ''),
                    'success'
                );
                
                setShowExtratoModal(false);
                setExtratoProcessado(null);
                setContaBancariaSelecionada('');
            };

            // Manipular upload de arquivos
            const handleFileUpload = (e) => {
                const files = Array.from(e.target.files);
                if (files.length === 0) return;

                const file = files[0];
                
                const allowedTypes = ['application/pdf', 'image/jpeg', 'image/png', 'image/jpg'];
                if (!allowedTypes.includes(file.type)) {
                    ToastManager.show('Tipo de arquivo não suportado. Use PDF, JPEG ou PNG.', 'error');
                    return;
                }

                if (file.size > 10 * 1024 * 1024) {
                    ToastManager.show('Arquivo muito grande. Máximo 10MB.', 'error');
                    return;
                }

                processDocumentWithOCR(file);
            };

            // Importar plano de contas do Excel
            const importarPlanoContas = (e) => {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = new Uint8Array(e.target.result);
                        const workbook = XLSX.read(data, { type: 'array' });
                        const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                        const jsonData = XLSX.utils.sheet_to_json(firstSheet, { header: ['codigoReduzido', 'conta', 'descricao'] });

                        const contas = jsonData.filter((row, index) => {
                            return index > 0 && row.codigoReduzido && row.conta && row.descricao;
                        });

                        setPlanoContas(contas);
                        ToastManager.show(`Plano de contas importado com ${contas.length} contas`, 'success');
                        setShowImportModal(false);
                    } catch (error) {
                        console.error('Erro ao importar plano de contas:', error);
                        ToastManager.show('Erro ao importar arquivo Excel. Verifique o formato.', 'error');
                    }
                };
                reader.readAsArrayBuffer(file);
            };

            // Importar histórico de contas do Excel
            const importarHistoricoContas = (e) => {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = new Uint8Array(e.target.result);
                        const workbook = XLSX.read(data, { type: 'array' });
                        const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                        const jsonData = XLSX.utils.sheet_to_json(firstSheet, { header: ['codigo', 'descricao'] });

                        const historicos = jsonData.filter((row, index) => {
                            return index > 0 && row.codigo && row.descricao;
                        });

                        setHistoricoContas(historicos);
                        ToastManager.show(`Histórico importado com ${historicos.length} itens`, 'success');
                    } catch (error) {
                        console.error('Erro ao importar histórico:', error);
                        ToastManager.show('Erro ao importar arquivo Excel. Verifique o formato.', 'error');
                    }
                };
                reader.readAsArrayBuffer(file);
            };

            // Exportar históricos para Excel
            const exportarHistoricosExcel = () => {
                try {
                    const worksheet = XLSX.utils.json_to_sheet(historicoContas);
                    const workbook = XLSX.utils.book_new();
                    XLSX.utils.book_append_sheet(workbook, worksheet, "Históricos");
                    XLSX.writeFile(workbook, "historicos.xlsx");
                    ToastManager.show('Históricos exportados com sucesso', 'success');
                } catch (error) {
                    console.error('Erro ao exportar históricos:', error);
                    ToastManager.show('Erro ao exportar históricos', 'error');
                }
            };

            // Adicionar novo histórico manualmente
            const adicionarHistorico = () => {
                const descricao = document.getElementById('nova-descricao').value;

                if (!descricao) {
                    ToastManager.show('Preencha a descrição', 'error');
                    return;
                }

                const novoHistorico = {
                    codigo: getProximoCodigo(),
                    descricao
                };

                setHistoricoContas(prev => [...prev, novoHistorico]);
                
                document.getElementById('nova-descricao').value = '';

                ToastManager.show('Histórico adicionado com sucesso', 'success');
            };

            // Adicionar nova conta manualmente
            const adicionarConta = () => {
                const codigoReduzido = document.getElementById('nova-conta-codigo').value;
                const conta = document.getElementById('nova-conta-numero').value;
                const descricao = document.getElementById('nova-conta-descricao').value;

                if (!codigoReduzido || !conta || !descricao) {
                    ToastManager.show('Preencha todos os campos da conta', 'error');
                    return;
                }

                const novaConta = {
                    codigoReduzido,
                    conta,
                    descricao
                };

                setPlanoContas(prev => [...prev, novaConta]);
                
                document.getElementById('nova-conta-codigo').value = '';
                document.getElementById('nova-conta-numero').value = '';
                document.getElementById('nova-conta-descricao').value = '';

                ToastManager.show('Conta adicionada com sucesso', 'success');
            };

            // Gerar arquivo CTBIL
            const gerarCTBIL = () => {
                try {
                    const documentosValidos = documentos.filter(doc => 
                        doc.contaDebito && doc.contaCredito && doc.valor
                    );

                    if (documentosValidos.length === 0) {
                        ToastManager.show('Nenhum documento com contas preenchidas para gerar CTBIL', 'warning');
                        return;
                    }

                    const ctbilContent = CTBILGenerator.generateCTBIL(documentosValidos, configCTBIL);
                    const filename = `CTBIL_${configCTBIL.dataFinal.replace(/-/g, '')}.TXT`;
                    
                    if (CTBILGenerator.downloadCTBIL(ctbilContent, filename)) {
                        ToastManager.show(`Arquivo CTBIL gerado com ${documentosValidos.length} lançamentos`, 'success');
                        setShowCTBILModal(false);
                    }
                } catch (error) {
                    console.error('Erro ao gerar CTBIL:', error);
                    ToastManager.show('Erro ao gerar arquivo CTBIL', 'error');
                }
            };

            // Excluir movimentações em massa
            const excluirMovimentacoes = () => {
                const { tipo, historico, dataInicio, dataFim } = deleteFilters;
                
                let documentosParaExcluir = documentos;

                // Aplicar filtros
                if (tipo) {
                    documentosParaExcluir = documentosParaExcluir.filter(doc => doc.tipoDocumento === tipo);
                }
                
                if (historico) {
                    documentosParaExcluir = documentosParaExcluir.filter(doc => 
                        doc.historico && doc.historico.toLowerCase().includes(historico.toLowerCase())
                    );
                }
                
                if (dataInicio) {
                    documentosParaExcluir = documentosParaExcluir.filter(doc => {
                        const docData = new Date(doc.processedAt);
                        const inicio = new Date(dataInicio);
                        return docData >= inicio;
                    });
                }
                
                if (dataFim) {
                    documentosParaExcluir = documentosParaExcluir.filter(doc => {
                        const docData = new Date(doc.processedAt);
                        const fim = new Date(dataFim);
                        return docData <= fim;
                    });
                }

                setDocumentos(prev => prev.filter(doc => !documentosParaExcluir.includes(doc)));

                ToastManager.show(`${documentosParaExcluir.length} movimentações excluídas com sucesso!`, 'success');
                setShowDeleteModal(false);
                setDeleteFilters({ tipo: '', historico: '', dataInicio: '', dataFim: '' });
            };

            // Iniciar edição em linha
            const iniciarEdicao = (documento, campo, valor, tipo = 'text', event) => {
                // Se for conta débito ou crédito, abre o modal
                if (campo === 'contaDebito' || campo === 'contaCredito') {
                    const tipoConta = campo === 'contaDebito' ? 'debito' : 'credito';
                    abrirModalConta(tipoConta, documento);
                    return;
                }

                setEditingCell({ id: documento.id, campo });
                setEditValue(valor || '');
                setDropdownType(tipo);
                setSearchTerm('');

                if (tipo === 'historico') {
                    const rect = event.target.getBoundingClientRect();
                    setDropdownPosition({
                        x: rect.left,
                        y: rect.bottom + window.scrollY
                    });
                    setShowDropdown(true);
                } else {
                    setShowEditModal(true);
                }
            };

            // Salvar edição do modal
            const salvarEdicaoModal = () => {
                if (!editingCell) return;

                setDocumentos(prev => prev.map(doc => 
                    doc.id === editingCell.id
                        ? { ...doc, [editingCell.campo]: editValue }
                        : doc
                ));

                setShowEditModal(false);
                setEditingCell(null);
                setEditValue('');
            };

            // Excluir documento
            const excluirDocumento = (id) => {
                if (confirm('Tem certeza que deseja excluir este documento?')) {
                    setDocumentos(prev => prev.filter(doc => doc.id !== id));
                    ToastManager.show('Documento excluído com sucesso', 'success');
                }
            };

            // Excluir histórico
            const excluirHistorico = (codigo) => {
                if (confirm('Tem certeza que deseja excluir este histórico?')) {
                    setHistoricoContas(prev => prev.filter(h => h.codigo !== codigo));
                    ToastManager.show('Histórico excluído com sucesso', 'success');
                }
            };

            // Editar histórico
            const editarHistorico = () => {
                if (!editingHistorico || !editHistoricoValue) {
                    ToastManager.show('Preencha a descrição do histórico', 'error');
                    return;
                }

                setHistoricoContas(prev => prev.map(h => 
                    h.codigo === editingHistorico.codigo 
                        ? { ...h, descricao: editHistoricoValue }
                        : h
                ));

                setEditingHistorico(null);
                setEditHistoricoValue('');
                ToastManager.show('Histórico atualizado com sucesso', 'success');
            };

            // Excluir conta
            const excluirConta = (codigoReduzido) => {
                if (confirm('Tem certeza que deseja excluir esta conta?')) {
                    setPlanoContas(prev => prev.filter(c => c.codigoReduzido !== codigoReduzido));
                    ToastManager.show('Conta excluída com sucesso', 'success');
                }
            };

            // Editar conta
            const editarConta = () => {
                if (!editingConta || !editContaValue.codigoReduzido || !editContaValue.conta || !editContaValue.descricao) {
                    ToastManager.show('Preencha todos os campos da conta', 'error');
                    return;
                }

                setPlanoContas(prev => prev.map(c => 
                    c.codigoReduzido === editingConta.codigoReduzido 
                        ? { ...editContaValue }
                        : c
                ));

                setEditingConta(null);
                setEditContaValue({ codigoReduzido: '', conta: '', descricao: '' });
                ToastManager.show('Conta atualizada com sucesso', 'success');
            };

            // Iniciar edição de histórico
            const iniciarEdicaoHistorico = (historico) => {
                setEditingHistorico(historico);
                setEditHistoricoValue(historico.descricao);
            };

            // Iniciar edição de conta
            const iniciarEdicaoConta = (conta) => {
                setEditingConta(conta);
                setEditContaValue({ ...conta });
            };

            // Filtrar contas baseado no termo de pesquisa e flag analíticas
            const contasFiltradas = useMemo(() => {
                let contas = planoContas;
                
                if (mostrarApenasAnaliticas) {
                    contas = contas.filter(conta => isContaAnalitica(conta.conta));
                }
                
                if (!searchTerm) return contas;
                
                return contas.filter(conta => 
                    conta.codigoReduzido?.toString().toLowerCase().includes(searchTerm.toLowerCase()) ||
                    conta.conta?.toString().toLowerCase().includes(searchTerm.toLowerCase()) ||
                    conta.descricao?.toString().toLowerCase().includes(searchTerm.toLowerCase())
                );
            }, [planoContas, searchTerm, mostrarApenasAnaliticas, isContaAnalitica]);

            // Filtrar históricos baseado no termo de pesquisa
            const historicosFiltrados = useMemo(() => {
                if (!searchTerm) return historicoContas;
                
                return historicoContas.filter(historico => 
                    historico.codigo?.toString().toLowerCase().includes(searchTerm.toLowerCase()) ||
                    historico.descricao?.toString().toLowerCase().includes(searchTerm.toLowerCase())
                );
            }, [historicoContas, searchTerm]);

            // Selecionar conta do dropdown (mantido para compatibilidade)
            const selecionarConta = (conta) => {
                const valorParaGravar = conta.conta;
                
                setDocumentos(prev => prev.map(doc => 
                    doc.id === editingCell.id
                        ? { ...doc, [editingCell.campo]: valorParaGravar }
                        : doc
                ));

                setShowDropdown(false);
                setEditingCell(null);
                setSearchTerm('');
            };

            // Selecionar histórico do dropdown
            const selecionarHistorico = (historico) => {
                const valorParaGravar = historico.descricao;
                
                setDocumentos(prev => prev.map(doc => 
                    doc.id === editingCell.id
                        ? { ...doc, [editingCell.campo]: valorParaGravar }
                        : doc
                ));

                setShowDropdown(false);
                setEditingCell(null);
                setSearchTerm('');
            };

            // Obter nome do tipo de documento
            const getDocumentTypeName = (type) => {
                const typeNames = {
                    'nota_fiscal': 'Nota Fiscal',
                    'boleto': 'Boleto',
                    'contrato': 'Contrato',
                    'holerite': 'Holerite',
                    'extrato': 'Extrato',
                    'outros': 'Outros'
                };
                return typeNames[type] || type;
            };

            // Obter cor da confiança
            const getConfidenceColor = (confidence) => {
                if (confidence >= 80) return 'confidence-high';
                if (confidence >= 60) return 'confidence-medium';
                return 'confidence-low';
            };

            // Detectar padrões de histórico para automação
            const detectarPadraoHistorico = (historico) => {
                const histLower = historico.toLowerCase();
                
                // Buscar documentos com histórico similar
                const documentosComMesmoHistorico = documentos.filter(doc => 
                    doc.historico && doc.historico.toLowerCase().includes(histLower.substring(0, 20))
                );

                if (documentosComMesmoHistorico.length > 1) {
                    // Encontrar contas mais usadas para este histórico
                    const contasDebito = documentosComMesmoHistorico
                        .filter(doc => doc.contaDebito)
                        .map(doc => doc.contaDebito);
                    
                    const contasCredito = documentosComMesmoHistorico
                        .filter(doc => doc.contaCredito)
                        .map(doc => doc.contaCredito);

                    // Encontrar a conta mais frequente
                    const contaDebitoMaisUsada = encontrarContaMaisFrequente(contasDebito);
                    const contaCreditoMaisUsada = encontrarContaMaisFrequente(contasCredito);

                    return {
                        historico: historico,
                        quantidade: documentosComMesmoHistorico.length,
                        contaDebito: contaDebitoMaisUsada,
                        contaCredito: contaCreditoMaisUsada,
                        documentos: documentosComMesmoHistorico
                    };
                }

                return null;
            };

            // Encontrar conta mais frequente
            const encontrarContaMaisFrequente = (contas) => {
                if (contas.length === 0) return '';
                
                const frequencia = {};
                contas.forEach(conta => {
                    frequencia[conta] = (frequencia[conta] || 0) + 1;
                });

                return Object.keys(frequencia).reduce((a, b) => 
                    frequencia[a] > frequencia[b] ? a : b
                );
            };

            // Iniciar automação para histórico
            const iniciarAutomacaoHistorico = (historico) => {
                const padrao = detectarPadraoHistorico(historico);
                if (padrao) {
                    setHistoricoParaAutomacao(padrao);
                    setContasSugeridas({
                        debito: padrao.contaDebito,
                        credito: padrao.contaCredito
                    });
                    setShowAutomacaoModal(true);
                } else {
                    ToastManager.show('Não foram encontrados padrões para este histórico', 'info');
                }
            };

            // Aplicar automação a todos os documentos com o mesmo histórico
            const aplicarAutomacao = () => {
                if (!historicoParaAutomacao) return;

                const { historico, contaDebito, contaCredito, documentos } = historicoParaAutomacao;

                setDocumentos(prev => prev.map(doc => {
                    if (doc.historico && doc.historico.toLowerCase().includes(historico.toLowerCase().substring(0, 20))) {
                        return {
                            ...doc,
                            contaDebito: contasSugeridas.debito || doc.contaDebito,
                            contaCredito: contasSugeridas.credito || doc.contaCredito
                        };
                    }
                    return doc;
                }));

                ToastManager.show(
                    `Automação aplicada a ${documentos.length} documentos com o histórico "${historico}"`,
                    'success'
                );

                setShowAutomacaoModal(false);
                setHistoricoParaAutomacao(null);
                setContasSugeridas({ debito: '', credito: '' });
            };

            // Modal de Seleção de Conta - AJUSTADO
            const ContaModal = () => {
                if (!showContaModal) return null;

                return (
                    <div className="fixed inset-0 z-50 flex items-center justify-center modal-overlay">
                        <div className="bg-white rounded-xl shadow-2xl p-6 conta-modal">
                            <div className="flex justify-between items-center mb-4">
                                <h3 className="text-lg font-bold text-gray-800">
                                    <i className="fas fa-university mr-2"></i>
                                    Selecionar Conta {contaModalType === 'debito' ? 'Débito' : 'Crédito'}
                                </h3>
                                <button 
                                    onClick={() => setShowContaModal(false)}
                                    className="text-gray-400 hover:text-gray-600 transition-colors"
                                >
                                    <i className="fas fa-times text-lg"></i>
                                </button>
                            </div>
                            
                            <div className="mb-4">
                                <input
                                    type="text"
                                    placeholder="Buscar conta por código ou descrição..."
                                    value={searchTerm}
                                    onChange={(e) => setSearchTerm(e.target.value)}
                                    className="search-input"
                                    autoFocus
                                />
                                <label className="flex items-center gap-2 text-xs mt-2">
                                    <input
                                        type="checkbox"
                                        checked={mostrarApenasAnaliticas}
                                        onChange={(e) => setMostrarApenasAnaliticas(e.target.checked)}
                                        className="rounded"
                                    />
                                    Mostrar apenas contas analíticas (formato X.X.X.XX.XXX)
                                </label>
                            </div>
                            
                            <div className="max-h-96 overflow-y-auto custom-scrollbar">
                                {contasFiltradas.length === 0 ? (
                                    <div className="text-center py-8 text-gray-500">
                                        <i className="fas fa-search text-2xl mb-2"></i>
                                        <p>Nenhuma conta encontrada</p>
                                        <p className="text-sm">Tente outro termo de pesquisa</p>
                                    </div>
                                ) : (
                                    <div className="space-y-2">
                                        {contasFiltradas.map((conta, index) => (
                                            <div
                                                key={index}
                                                className="dropdown-option p-3 border border-gray-200 rounded-lg hover:border-blue-300 cursor-pointer"
                                                onClick={() => selecionarContaModal(conta)}
                                            >
                                                {/* AJUSTADO: Informações em linha única */}
                                                <div className="conta-line">
                                                    <span className="conta-codigo">{conta.codigoReduzido}</span>
                                                    <span className="text-gray-400">-</span>
                                                    <span className="conta-numero">{conta.conta}</span>
                                                    <span className="text-gray-400">-</span>
                                                    <span className="conta-descricao">{conta.descricao}</span>
                                                    {isContaAnalitica(conta.conta) && (
                                                        <span className="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full ml-2 whitespace-nowrap">
                                                            Analítica
                                                        </span>
                                                    )}
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                            
                            <div className="mt-4 text-xs text-gray-500 text-center">
                                {contasFiltradas.length} de {planoContas.length} contas
                                {mostrarApenasAnaliticas && ' (analíticas)'}
                            </div>
                        </div>
                    </div>
                );
            };

            // Modal de Informações do Sistema
            const InfoModal = () => {
                if (!showInfoModal) return null;

                return (
                    <div className="fixed inset-0 z-50 flex items-center justify-center modal-overlay">
                        <div className="bg-white rounded-xl shadow-2xl p-6 max-w-2xl w-full mx-4">
                            <div className="flex justify-between items-center mb-4">
                                <h3 className="text-lg font-bold text-gray-800">
                                    <i className="fas fa-info-circle text-blue-500 mr-2"></i>
                                    Funcionalidades do Sistema EmailPro
                                </h3>
                                <button 
                                    onClick={() => setShowInfoModal(false)}
                                    className="text-gray-400 hover:text-gray-600 transition-colors"
                                >
                                    <i className="fas fa-times text-lg"></i>
                                </button>
                            </div>
                            
                            <div className="space-y-4 text-sm text-gray-600 max-h-96 overflow-y-auto">
                                <div className="bg-blue-50 p-4 rounded-lg">
                                    <h4 className="font-semibold text-blue-800 mb-2">Processamento Automático de Documentos</h4>
                                    <ul className="list-disc list-inside space-y-1">
                                        <li>Reconhecimento inteligente de tipos de documentos (Notas Fiscais, Boletos, Contratos, Holerites, Extratos)</li>
                                        <li>Extração automática de dados como CPF/CNPJ, valores, datas de vencimento e nomes</li>
                                        <li>Processamento via OCR para documentos digitalizados e PDFs</li>
                                    </ul>
                                </div>
                                
                                <div className="bg-green-50 p-4 rounded-lg">
                                    <h4 className="font-semibold text-green-800 mb-2">Gestão de Lançamentos Contábeis</h4>
                                    <ul className="list-disc list-inside space-y-1">
                                        <li>Associação automática com plano de contas</li>
                                        <li>Geração de históricos padronizados</li>
                                        <li>Classificação por tipo de documento e conta</li>
                                    </ul>
                                </div>
                                
                                <div className="bg-purple-50 p-4 rounded-lg">
                                    <h4 className="font-semibold text-purple-800 mb-2">Exportação CTBIL</h4>
                                    <ul className="list-disc list-inside space-y-1">
                                        <li>Geração automática do arquivo CTBIL com layout correto</li>
                                        <li>Validação de dados antes da exportação</li>
                                        <li>Configuração de filiais e datas</li>
                                    </ul>
                                </div>
                                
                                <div className="bg-yellow-50 p-4 rounded-lg">
                                    <h4 className="font-semibold text-yellow-800 mb-2">Processamento de Extratos</h4>
                                    <ul className="list-disc list-inside space-y-1">
                                        <li>Reconhecimento automático de extratos bancários</li>
                                        <li>Importação em lote de múltiplas transações</li>
                                        <li>Configuração inteligente de contas débito/crédito</li>
                                        <li>Filtro automático de transações irrelevantes (Saldo do dia, valores zero)</li>
                                    </ul>
                                </div>
                            </div>
                            
                            <div className="mt-6 flex justify-end">
                                <button
                                    onClick={() => setShowInfoModal(false)}
                                    className="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors"
                                >
                                    Entendi
                                </button>
                            </div>
                        </div>
                    </div>
                );
            };

            // Modal de Processamento de Extratos
            const ExtratoModal = () => {
                if (!showExtratoModal || !extratoProcessado) return null;

                return (
                    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 modal-overlay">
                        <div className="bg-white rounded-xl max-w-6xl w-full max-h-[90vh] overflow-hidden">
                            <div className="p-4 border-b border-gray-200">
                                <div className="flex justify-between items-center">
                                    <h3 className="text-lg font-bold text-gray-800">
                                        <i className="fas fa-file-invoice-dollar text-green-600 mr-2"></i>
                                        Processar Extrato Bancário
                                    </h3>
                                    <button
                                        onClick={() => {
                                            setShowExtratoModal(false);
                                            setExtratoProcessado(null);
                                        }}
                                        className="text-gray-400 hover:text-gray-600 transition"
                                    >
                                        <i className="fas fa-times"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <div className="p-4 space-y-4 overflow-y-auto max-h-[70vh]">
                                {/* Resumo do Extrato */}
                                <div className="bg-blue-50 p-4 rounded-lg">
                                    <div className="grid grid-cols-4 gap-4 text-sm">
                                        <div>
                                            <span className="font-semibold">Total de Transações:</span>
                                            <p className="text-lg text-blue-700">{extratoProcessado.totalTransacoes}</p>
                                        </div>
                                        <div>
                                            <span className="font-semibold">Período:</span>
                                            <p className="text-blue-700">{extratoProcessado.periodo}</p>
                                        </div>
                                        <div>
                                            <span className="font-semibold">Entradas:</span>
                                            <p className="text-green-600">
                                                {extratoProcessado.transacoes.filter(t => t.tipo === 'entrada').length}
                                            </p>
                                        </div>
                                        <div>
                                            <span className="font-semibold">Saídas:</span>
                                            <p className="text-red-600">
                                                {extratoProcessado.transacoes.filter(t => t.tipo === 'saida').length}
                                            </p>
                                        </div>
                                    </div>
                                </div>

                                {/* Seleção da Conta Bancária */}
                                <div className="bg-yellow-50 p-4 rounded-lg border border-yellow-200">
                                    <h4 className="font-semibold text-yellow-800 mb-3">
                                        <i className="fas fa-university mr-2"></i>
                                        Selecionar Conta Bancária
                                    </h4>
                                    <p className="text-sm text-yellow-700 mb-3">
                                        Para cada transação do extrato, o sistema irá:
                                    </p>
                                    <ul className="text-sm text-yellow-700 list-disc list-inside space-y-1 mb-3">
                                        <li><strong>Entradas:</strong> Conta selecionada será a <strong>Débito</strong></li>
                                        <li><strong>Saídas:</strong> Conta selecionada será a <strong>Crédito</strong></li>
                                    </ul>
                                    
                                    <div className="flex gap-3 items-center">
                                        <select
                                            value={contaBancariaSelecionada}
                                            onChange={(e) => setContaBancariaSelecionada(e.target.value)}
                                            className="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm"
                                        >
                                            <option value="">Selecione uma conta...</option>
                                            {planoContas.filter(conta => 
                                                conta.descricao.toLowerCase().includes('banco') || 
                                                conta.descricao.toLowerCase().includes('caixa') ||
                                                conta.descricao.toLowerCase().includes('conta corrente')
                                            ).map((conta, index) => (
                                                <option key={index} value={conta.conta}>
                                                    {conta.conta} - {conta.descricao}
                                                </option>
                                            ))}
                                        </select>
                                        
                                        <button
                                            onClick={() => setShowImportModal(true)}
                                            className="bg-green-600 hover:bg-green-700 text-white px-3 py-2 rounded-lg text-sm flex items-center gap-2"
                                        >
                                            <i className="fas fa-plus"></i>
                                            Nova Conta
                                        </button>
                                    </div>
                                </div>

                                {/* Pré-visualização das Transações */}
                                <div>
                                    <h4 className="font-semibold text-gray-700 mb-3">
                                        Pré-visualização das Transações ({extratoProcessado.transacoes.length})
                                    </h4>
                                    <div className="overflow-y-auto max-h-64 border border-gray-200 rounded-lg">
                                        <table className="min-w-full divide-y divide-gray-200 text-sm">
                                            <thead className="bg-gray-100">
                                                <tr>
                                                    <th className="px-3 py-2 text-left text-xs font-medium uppercase">Data</th>
                                                    <th className="px-3 py-2 text-left text-xs font-medium uppercase">Histórico</th>
                                                    <th className="px-3 py-2 text-left text-xs font-medium uppercase">Valor</th>
                                                    <th className="px-3 py-2 text-left text-xs font-medium uppercase">Tipo</th>
                                                    <th className="px-3 py-2 text-left text-xs font-medium uppercase">Conta Débito</th>
                                                    <th className="px-3 py-2 text-left text-xs font-medium uppercase">Conta Crédito</th>
                                                </tr>
                                            </thead>
                                            <tbody className="bg-white divide-y divide-gray-200">
                                                {extratoProcessado.transacoes.slice(0, 10).map((transacao, index) => (
                                                    <tr key={index} className={`transacao-row ${transacao.tipo === 'entrada' ? 'transacao-entrada' : 'transacao-saida'}`}>
                                                        <td className="px-3 py-2 whitespace-nowrap text-xs">{transacao.data}</td>
                                                        <td className="px-3 py-2 text-xs truncate max-w-[200px]" title={transacao.historico}>
                                                            {transacao.historico}
                                                        </td>
                                                        <td className={`px-3 py-2 whitespace-nowrap text-xs font-medium ${
                                                            transacao.tipo === 'entrada' ? 'text-green-600' : 'text-red-600'
                                                        }`}>
                                                            {transacao.valor}
                                                        </td>
                                                        <td className="px-3 py-2 whitespace-nowrap text-xs">
                                                            <span className={`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${
                                                                transacao.tipo === 'entrada' 
                                                                    ? 'bg-green-100 text-green-800'
                                                                    : 'bg-red-100 text-red-800'
                                                            }`}>
                                                                {transacao.tipo === 'entrada' ? 'Entrada' : 'Saída'}
                                                            </span>
                                                        </td>
                                                        <td className="px-3 py-2 whitespace-nowrap text-xs">
                                                            {transacao.tipo === 'entrada' ? contaBancariaSelecionada || '-' : '-'}
                                                        </td>
                                                        <td className="px-3 py-2 whitespace-nowrap text-xs">
                                                            {transacao.tipo === 'saida' ? contaBancariaSelecionada || '-' : '-'}
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                        {extratoProcessado.transacoes.length > 10 && (
                                            <div className="p-3 text-center text-xs text-gray-500 bg-gray-100">
                                                + {extratoProcessado.transacoes.length - 10} transações adicionais
                                            </div>
                                        )}
                                    </div>
                                </div>
                            </div>
                            
                            <div className="p-4 border-t border-gray-200 flex gap-2">
                                <button
                                    onClick={() => {
                                        setShowExtratoModal(false);
                                        setExtratoProcessado(null);
                                    }}
                                    className="flex-1 bg-gray-200 text-gray-700 px-3 py-2 rounded-lg text-sm card-hover transition"
                                >
                                    Cancelar
                                </button>
                                <button
                                    onClick={importarExtrato}
                                    disabled={!contaBancariaSelecionada}
                                    className={`flex-1 px-3 py-2 rounded-lg text-sm card-hover transition flex items-center justify-center gap-2 ${
                                        contaBancariaSelecionada
                                            ? 'bg-green-600 hover:bg-green-700 text-white'
                                            : 'bg-gray-300 text-gray-500 cursor-not-allowed'
                                    }`}
                                >
                                    <i className="fas fa-file-import"></i>
                                    Importar {extratoProcessado.totalTransacoes} Transações
                                </button>
                            </div>
                        </div>
                    </div>
                );
            };

            // Modal de Automação de Históricos
            const AutomacaoModal = () => {
                if (!showAutomacaoModal || !historicoParaAutomacao) return null;

                return (
                    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 modal-overlay">
                        <div className="bg-white rounded-xl max-w-2xl w-full">
                            <div className="p-4 border-b border-gray-200">
                                <div className="flex justify-between items-center">
                                    <h3 className="text-lg font-bold text-gray-800">
                                        <i className="fas fa-robot text-purple-600 mr-2"></i>
                                        Automação de Históricos
                                    </h3>
                                    <button
                                        onClick={() => {
                                            setShowAutomacaoModal(false);
                                            setHistoricoParaAutomacao(null);
                                        }}
                                        className="text-gray-400 hover:text-gray-600 transition"
                                    >
                                        <i className="fas fa-times"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <div className="p-4 space-y-4">
                                <div className="bg-purple-50 p-4 rounded-lg">
                                    <h4 className="font-semibold text-purple-800 mb-2">
                                        Padrão Detectado: "{historicoParaAutomacao.historico}"
                                    </h4>
                                    <p className="text-sm text-purple-700">
                                        Foram encontrados <strong>{historicoParaAutomacao.quantidade} documentos</strong> com histórico similar.
                                    </p>
                                </div>

                                <div className="space-y-3">
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">
                                            Conta Débito Sugerida
                                        </label>
                                        <select
                                            value={contasSugeridas.debito}
                                            onChange={(e) => setContasSugeridas(prev => ({...prev, debito: e.target.value}))}
                                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"
                                        >
                                            <option value="">Selecione uma conta débito...</option>
                                            {planoContas.map((conta, index) => (
                                                <option key={index} value={conta.conta}>
                                                    {conta.conta} - {conta.descricao}
                                                </option>
                                            ))}
                                        </select>
                                        {historicoParaAutomacao.contaDebito && (
                                            <p className="text-xs text-gray-500 mt-1">
                                                Sugerido: {historicoParaAutomacao.contaDebito}
                                            </p>
                                        )}
                                    </div>

                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">
                                            Conta Crédito Sugerida
                                        </label>
                                        <select
                                            value={contasSugeridas.credito}
                                            onChange={(e) => setContasSugeridas(prev => ({...prev, credito: e.target.value}))}
                                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"
                                        >
                                            <option value="">Selecione uma conta crédito...</option>
                                            {planoContas.map((conta, index) => (
                                                <option key={index} value={conta.conta}>
                                                    {conta.conta} - {conta.descricao}
                                                </option>
                                            ))}
                                        </select>
                                        {historicoParaAutomacao.contaCredito && (
                                            <p className="text-xs text-gray-500 mt-1">
                                                Sugerido: {historicoParaAutomacao.contaCredito}
                                            </p>
                                        )}
                                    </div>
                                </div>

                                <div className="bg-yellow-50 p-3 rounded-lg">
                                    <h4 className="font-semibold text-yellow-800 text-sm mb-2">Atenção</h4>
                                    <p className="text-xs text-yellow-700">
                                        Esta ação irá aplicar as contas selecionadas a todos os <strong>{historicoParaAutomacao.quantidade} documentos</strong> 
                                        que possuem o histórico "{historicoParaAutomacao.historico}".
                                    </p>
                                </div>
                            </div>
                            
                            <div className="p-4 border-t border-gray-200 flex gap-2">
                                <button
                                    onClick={() => {
                                        setShowAutomacaoModal(false);
                                        setHistoricoParaAutomacao(null);
                                    }}
                                    className="flex-1 bg-gray-200 text-gray-700 px-3 py-2 rounded-lg text-sm card-hover transition"
                                >
                                    Cancelar
                                </button>
                                <button
                                    onClick={aplicarAutomacao}
                                    className="flex-1 bg-purple-600 hover:bg-purple-700 text-white px-3 py-2 rounded-lg text-sm card-hover transition flex items-center justify-center gap-2"
                                >
                                    <i className="fas fa-bolt"></i>
                                    Aplicar a {historicoParaAutomacao.quantidade} Documentos
                                </button>
                            </div>
                        </div>
                    </div>
                );
            };

            // Modal de Exclusão em Massa
            const DeleteModal = () => {
                if (!showDeleteModal) return null;

                return (
                    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 modal-overlay">
                        <div className="bg-white rounded-xl max-w-md w-full">
                            <div className="p-4 border-b border-gray-200">
                                <div className="flex justify-between items-center">
                                    <h3 className="text-lg font-bold text-gray-800">
                                        <i className="fas fa-trash text-red-600 mr-2"></i>
                                        Excluir Movimentações
                                    </h3>
                                    <button
                                        onClick={() => setShowDeleteModal(false)}
                                        className="text-gray-400 hover:text-gray-600 transition"
                                    >
                                        <i className="fas fa-times"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <div className="p-4 space-y-4">
                                <div className="text-sm text-gray-600">
                                    <p>Configure os filtros para selecionar quais movimentações deseja excluir:</p>
                                </div>

                                <div className="space-y-3">
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">
                                            Tipo de Documento
                                        </label>
                                        <select
                                            value={deleteFilters.tipo}
                                            onChange={(e) => setDeleteFilters(prev => ({...prev, tipo: e.target.value}))}
                                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"
                                        >
                                            <option value="">Todos os tipos</option>
                                            <option value="nota_fiscal">Nota Fiscal</option>
                                            <option value="boleto">Boleto</option>
                                            <option value="contrato">Contrato</option>
                                            <option value="holerite">Holerite</option>
                                            <option value="extrato">Extrato</option>
                                            <option value="outros">Outros</option>
                                        </select>
                                    </div>
                                    
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">
                                            Histórico
                                        </label>
                                        <input
                                            type="text"
                                            value={deleteFilters.historico}
                                            onChange={(e) => setDeleteFilters(prev => ({...prev, historico: e.target.value}))}
                                            placeholder="Filtrar por histórico..."
                                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"
                                        />
                                    </div>
                                    
                                    <div className="grid grid-cols-2 gap-3">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">
                                                Data Início
                                            </label>
                                            <input
                                                type="date"
                                                value={deleteFilters.dataInicio}
                                                onChange={(e) => setDeleteFilters(prev => ({...prev, dataInicio: e.target.value}))}
                                                className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">
                                                Data Fim
                                            </label>
                                            <input
                                                type="date"
                                                value={deleteFilters.dataFim}
                                                onChange={(e) => setDeleteFilters(prev => ({...prev, dataFim: e.target.value}))}
                                                className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"
                                            />
                                        </div>
                                    </div>
                                </div>

                                <div className="bg-red-50 p-3 rounded-lg">
                                    <h4 className="font-semibold text-red-800 text-sm mb-2">Atenção</h4>
                                    <p className="text-xs text-red-700">
                                        Esta ação é irreversível. Todas as movimentações que corresponderem aos filtros serão excluídas permanentemente.
                                    </p>
                                </div>
                            </div>
                            
                            <div className="p-4 border-t border-gray-200 flex gap-2">
                                <button
                                    onClick={() => setShowDeleteModal(false)}
                                    className="flex-1 bg-gray-200 text-gray-700 px-3 py-2 rounded-lg text-sm card-hover transition"
                                >
                                    Cancelar
                                </button>
                                <button
                                    onClick={excluirMovimentacoes}
                                    className="flex-1 bg-red-600 hover:bg-red-700 text-white px-3 py-2 rounded-lg text-sm card-hover transition flex items-center justify-center gap-2"
                                >
                                    <i className="fas fa-trash"></i>
                                    Excluir
                                </button>
                            </div>
                        </div>
                    </div>
                );
            };

            if (isLoading) {
                return (
                    <div className="min-h-screen flex items-center justify-center">
                        <div className="bg-white rounded-2xl p-8 text-center">
                            <i className="fas fa-spinner fa-spin text-3xl text-blue-600 mb-4"></i>
                            <p className="text-gray-600">Carregando Sistema de Documentos...</p>
                        </div>
                    </div>
                );
            }

            return (
                <div className="fade-in">
                    {/* Header */}
                    <div className="bg-white rounded-xl shadow-lg border border-gray-200 mb-6 p-4 card-hover">
                        <div className="flex justify-between items-center">
                            <div className="flex items-center gap-3">
                                <div className="bg-gradient-to-r from-blue-600 to-purple-600 p-2 rounded-lg">
                                    <i className="fas fa-file-invoice text-xl text-white"></i>
                                </div>
                                <div>
                                    <h1 className="text-lg font-bold text-gray-800">Sistema de Documentos</h1>
                                    <p className="text-gray-600 text-xs">Reconhecimento e gestão de documentos</p>
                                </div>
                            </div>
                            
                            <div className="flex items-center gap-3">
                                <div className="flex items-center gap-2">
                                    <div 
                                        className="info-icon"
                                        onClick={() => setShowInfoModal(true)}
                                        title="Informações do Sistema"
                                    >
                                        <i className="fas fa-info"></i>
                                    </div>
                                    <button
                                        onClick={() => setShowCTBILModal(true)}
                                        className="bg-orange-600 hover:bg-orange-700 text-white px-3 py-1.5 rounded-lg card-hover transition flex items-center gap-2 text-sm"
                                    >
                                        <i className="fas fa-file-export"></i>
                                        Gerar CTBIL
                                    </button>
                                </div>
                                <button
                                    onClick={() => setShowHistoricoModal(true)}
                                    className="bg-purple-600 hover:bg-purple-700 text-white px-3 py-1.5 rounded-lg card-hover transition flex items-center gap-2 text-sm"
                                    >
                                    <i className="fas fa-history"></i>
                                    Históricos
                                </button>
                                <button
                                    onClick={() => setShowImportModal(true)}
                                    className="bg-green-600 hover:bg-green-700 text-white px-3 py-1.5 rounded-lg card-hover transition flex items-center gap-2 text-sm"
                                >
                                    <i className="fas fa-file-excel"></i>
                                    Plano de Contas
                                </button>
                                <button
                                    onClick={() => window.location.href = 'index.html'}
                                    className="bg-white text-gray-700 px-3 py-1.5 rounded-lg border border-gray-300 card-hover transition flex items-center gap-2 hover:border-blue-500 hover:text-blue-600 text-sm"
                                >
                                    <i className="fas fa-home"></i>
                                    Página Inicial
                                </button>
                            </div>
                        </div>
                    </div>

                    <div className="grid grid-cols-1 lg:grid-cols-4 gap-4">
                        {/* Sidebar */}
                        <div className="lg:col-span-1">
                            <div className="bg-white rounded-xl shadow-lg border border-gray-200 p-3">
                                <nav className="space-y-1">
                                    {[
                                        { id: 'documents', icon: 'fa-file-alt', label: `Documentos (${documentos.length})` },
                                        { id: 'upload', icon: 'fa-upload', label: 'Upload' }
                                    ].map(item => (
                                        <button
                                            key={item.id}
                                            onClick={() => setCurrentView(item.id)}
                                            className={`w-full text-left p-2 rounded-lg transition-all duration-200 sidebar-item text-sm ${
                                                currentView === item.id ? 'active' : 'text-gray-600 hover:text-gray-900'
                                            }`}
                                        >
                                            <div className="flex items-center gap-2">
                                                <i className={`fas ${item.icon} w-4 text-center ${currentView === item.id ? 'text-blue-600' : 'text-gray-400'}`}></i>
                                                <span className="font-medium">{item.label}</span>
                                            </div>
                                        </button>
                                    ))}
                                </nav>

                                {/* Estatísticas */}
                                <div className="mt-4 p-3 bg-gray-50 rounded-lg border border-gray-200">
                                    <h3 className="text-sm font-semibold text-gray-700 mb-2">Estatísticas</h3>
                                    <div className="space-y-1 text-xs text-gray-600">
                                        <div className="flex justify-between">
                                            <span>Notas Fiscais:</span>
                                            <span>{documentos.filter(d => d.tipoDocumento === 'nota_fiscal').length}</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span>Boletos:</span>
                                            <span>{documentos.filter(d => d.tipoDocumento === 'boleto').length}</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span>Contratos:</span>
                                            <span>{documentos.filter(d => d.tipoDocumento === 'contrato').length}</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span>Extratos:</span>
                                            <span>{documentos.filter(d => d.tipoDocumento === 'extrato').length}</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span>Outros:</span>
                                            <span>{documentos.filter(d => d.tipoDocumento === 'outros').length}</span>
                                        </div>
                                        <div className="flex justify-between border-t pt-1 mt-1">
                                            <span className="font-semibold">Prontos CTBIL:</span>
                                            <span className="font-semibold text-green-600">
                                                {documentos.filter(d => d.contaDebito && d.contaCredito && d.valor).length}
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* Main Content */}
                        <div className="lg:col-span-3">
                            <div className="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden">
                                <div className="p-4">
                                    {/* View: Lista de Documentos */}
                                    {currentView === 'documents' && (
                                        <div className="fade-in">
                                            <div className="flex justify-between items-center mb-4">
                                                <h2 className="text-lg font-bold text-gray-800">Documentos Processados</h2>
                                                <div className="flex gap-2">
                                                    <button
                                                        onClick={() => setShowDeleteModal(true)}
                                                        className="btn-danger text-white px-3 py-1.5 rounded-lg flex items-center gap-2 text-xs"
                                                    >
                                                        <i className="fas fa-trash"></i>
                                                        Excluir Movimentações
                                                    </button>
                                                    <button
                                                        onClick={() => setCurrentView('upload')}
                                                        className="btn-primary text-white px-3 py-1.5 rounded-lg flex items-center gap-2 text-xs"
                                                    >
                                                        <i className="fas fa-plus"></i>
                                                        Novo Documento
                                                    </button>
                                                </div>
                                            </div>

                                            {/* Filtros */}
                                            <div className="mb-4 space-y-3">
                                                <div className="flex flex-wrap gap-2">
                                                    <span className="text-xs font-medium text-gray-700 self-center">Filtrar por Tipo:</span>
                                                    <button
                                                        onClick={() => setFiltroTipo('todos')}
                                                        className={`filter-badge ${filtroTipo === 'todos' ? 'active' : ''}`}
                                                    >
                                                        Todos ({documentos.length})
                                                    </button>
                                                    <button
                                                        onClick={() => setFiltroTipo('nota_fiscal')}
                                                        className={`filter-badge ${filtroTipo === 'nota_fiscal' ? 'active' : ''}`}
                                                    >
                                                        Notas Fiscais ({documentos.filter(d => d.tipoDocumento === 'nota_fiscal').length})
                                                    </button>
                                                    <button
                                                        onClick={() => setFiltroTipo('boleto')}
                                                        className={`filter-badge ${filtroTipo === 'boleto' ? 'active' : ''}`}
                                                    >
                                                        Boletos ({documentos.filter(d => d.tipoDocumento === 'boleto').length})
                                                    </button>
                                                    <button
                                                        onClick={() => setFiltroTipo('extrato')}
                                                        className={`filter-badge ${filtroTipo === 'extrato' ? 'active' : ''}`}
                                                    >
                                                        Extratos ({documentos.filter(d => d.tipoDocumento === 'extrato').length})
                                                    </button>
                                                    <button
                                                        onClick={() => setFiltroTipo('outros')}
                                                        className={`filter-badge ${filtroTipo === 'outros' ? 'active' : ''}`}
                                                    >
                                                        Outros ({documentos.filter(d => d.tipoDocumento === 'outros').length})
                                                    </button>
                                                </div>

                                                <div className="flex flex-wrap gap-2">
                                                    <span className="text-xs font-medium text-gray-700 self-center">Filtrar por Contas:</span>
                                                    <button
                                                        onClick={() => setFiltroContas('todos')}
                                                        className={`filter-badge ${filtroContas === 'todos' ? 'active' : ''}`}
                                                    >
                                                        Todos
                                                    </button>
                                                    <button
                                                        onClick={() => setFiltroContas('sem_debito')}
                                                        className={`filter-badge ${filtroContas === 'sem_debito' ? 'active' : ''}`}
                                                    >
                                                        Sem Débito ({documentos.filter(d => !d.contaDebito).length})
                                                    </button>
                                                    <button
                                                        onClick={() => setFiltroContas('sem_credito')}
                                                        className={`filter-badge ${filtroContas === 'sem_credito' ? 'active' : ''}`}
                                                    >
                                                        Sem Crédito ({documentos.filter(d => !d.contaCredito).length})
                                                    </button>
                                                    <button
                                                        onClick={() => setFiltroContas('sem_contas')}
                                                        className={`filter-badge ${filtroContas === 'sem_contas' ? 'active' : ''}`}
                                                    >
                                                        Sem Contas ({documentos.filter(d => !d.contaDebito || !d.contaCredito).length})
                                                    </button>
                                                    <button
                                                        onClick={() => setFiltroContas('completos')}
                                                        className={`filter-badge ${filtroContas === 'completos' ? 'active' : ''}`}
                                                    >
                                                        Completos ({documentos.filter(d => d.contaDebito && d.contaCredito).length})
                                                    </button>
                                                </div>

                                                <div className="flex flex-wrap gap-2">
                                                    <span className="text-xs font-medium text-gray-700 self-center">Filtrar por Histórico:</span>
                                                    <select
                                                        value={filtroHistorico}
                                                        onChange={(e) => setFiltroHistorico(e.target.value)}
                                                        className="px-3 py-1 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-xs"
                                                    >
                                                        <option value="">Todos os históricos</option>
                                                        {historicosUnicos.map(historico => (
                                                            <option key={historico} value={historico}>{historico}</option>
                                                        ))}
                                                    </select>
                                                </div>
                                            </div>

                                            {documentosFiltrados.length === 0 ? (
                                                <div className="text-center py-8 text-gray-500">
                                                    <i className="fas fa-file-alt text-3xl mb-3 text-gray-300"></i>
                                                    <p className="text-sm mb-1">Nenhum documento encontrado</p>
                                                    <p className="text-xs">Ajuste os filtros ou faça upload de novos documentos</p>
                                                    <button
                                                        onClick={() => setCurrentView('upload')}
                                                        className="btn-primary text-white px-4 py-1.5 rounded-lg mt-3 text-xs"
                                                    >
                                                        <i className="fas fa-upload mr-1"></i>
                                                        Fazer Upload
                                                    </button>
                                                </div>
                                            ) : (
                                                // AJUSTADO: Container com scroll vertical - altura reduzida
                                                <div className="table-container custom-scrollbar">
                                                    <table className="min-w-full divide-y divide-gray-200 compact-table">
                                                        <thead className="grid-header">
                                                            <tr>
                                                                <th className="px-3 py-2 text-left text-xs font-medium uppercase tracking-wider">
                                                                    Tipo
                                                                </th>
                                                                <th className="px-3 py-2 text-left text-xs font-medium uppercase tracking-wider">
                                                                    CPF/CNPJ
                                                                </th>
                                                                <th className="px-3 py-2 text-left text-xs font-medium uppercase tracking-wider">
                                                                    Valor
                                                                </th>
                                                                <th className="px-3 py-2 text-left text-xs font-medium uppercase tracking-wider">
                                                                    Vencimento
                                                                </th>
                                                                <th className="px-3 py-2 text-left text-xs font-medium uppercase tracking-wider">
                                                                    Beneficiário
                                                                </th>
                                                                <th className="px-3 py-2 text-left text-xs font-medium uppercase tracking-wider">
                                                                    Pagador
                                                                </th>
                                                                <th className="px-3 py-2 text-left text-xs font-medium uppercase tracking-wider">
                                                                    Conta Débito
                                                                </th>
                                                                <th className="px-3 py-2 text-left text-xs font-medium uppercase tracking-wider">
                                                                    Conta Crédito
                                                                </th>
                                                                <th className="px-3 py-2 text-left text-xs font-medium uppercase tracking-wider">
                                                                    Histórico
                                                                </th>
                                                                <th className="px-3 py-2 text-left text-xs font-medium uppercase tracking-wider">
                                                                    Confiança
                                                                </th>
                                                                <th className="px-3 py-2 text-left text-xs font-medium uppercase tracking-wider">
                                                                    Ações
                                                                </th>
                                                            </tr>
                                                        </thead>
                                                        <tbody className="bg-white divide-y divide-gray-200">
                                                            {documentosFiltrados.map((documento) => (
                                                                <tr key={documento.id} className="document-row">
                                                                    {/* Tipo Documento */}
                                                                    <td className="px-3 py-2 whitespace-nowrap">
                                                                        <span className={`document-type-badge document-type-${documento.tipoDocumento}`}>
                                                                            {getDocumentTypeName(documento.tipoDocumento)}
                                                                        </span>
                                                                    </td>

                                                                    {/* CPF/CNPJ */}
                                                                    <td className="px-3 py-2 whitespace-nowrap">
                                                                        <div
                                                                            className="editable-field"
                                                                            onClick={(e) => iniciarEdicao(documento, 'cpfCnpj', documento.cpfCnpj, 'text', e)}
                                                                        >
                                                                            {documento.cpfCnpj || '-'}
                                                                        </div>
                                                                    </td>

                                                                    {/* Valor */}
                                                                    <td className="px-3 py-2 whitespace-nowrap">
                                                                        <div
                                                                            className="editable-field font-medium"
                                                                            onClick={(e) => iniciarEdicao(documento, 'valor', documento.valor, 'text', e)}
                                                                        >
                                                                            {documento.valor || '-'}
                                                                        </div>
                                                                    </td>

                                                                    {/* Data Vencimento */}
                                                                    <td className="px-3 py-2 whitespace-nowrap">
                                                                        <div
                                                                            className="editable-field"
                                                                            onClick={(e) => iniciarEdicao(documento, 'dataVencimento', documento.dataVencimento, 'text', e)}
                                                                        >
                                                                            {documento.dataVencimento || '-'}
                                                                        </div>
                                                                    </td>

                                                                    {/* Beneficiário */}
                                                                    <td className="px-3 py-2">
                                                                        <div
                                                                            className="editable-field truncate max-w-[120px]"
                                                                            onClick={(e) => iniciarEdicao(documento, 'beneficiario', documento.beneficiario, 'text', e)}
                                                                        >
                                                                            {documento.beneficiario || '-'}
                                                                        </div>
                                                                    </td>

                                                                    {/* Pagador */}
                                                                    <td className="px-3 py-2">
                                                                        <div
                                                                            className="editable-field truncate max-w-[120px]"
                                                                            onClick={(e) => iniciarEdicao(documento, 'pagador', documento.pagador, 'text', e)}
                                                                        >
                                                                            {documento.pagador || '-'}
                                                                        </div>
                                                                    </td>

                                                                    {/* Conta Débito - Agora abre modal */}
                                                                    <td className="px-3 py-2 whitespace-nowrap">
                                                                        <div
                                                                            className={`account-badge account-debito ${documento.contaDebito ? '' : 'opacity-50'}`}
                                                                            onClick={(e) => iniciarEdicao(documento, 'contaDebito', documento.contaDebito, 'conta', e)}
                                                                        >
                                                                            {documento.contaDebito || 'Selecionar'}
                                                                        </div>
                                                                    </td>

                                                                    {/* Conta Crédito - Agora abre modal */}
                                                                    <td className="px-3 py-2 whitespace-nowrap">
                                                                        <div
                                                                            className={`account-badge account-credito ${documento.contaCredito ? '' : 'opacity-50'}`}
                                                                            onClick={(e) => iniciarEdicao(documento, 'contaCredito', documento.contaCredito, 'conta', e)}
                                                                        >
                                                                            {documento.contaCredito || 'Selecionar'}
                                                                        </div>
                                                                    </td>

                                                                    {/* Histórico */}
                                                                    <td className="px-3 py-2">
                                                                        <div className="flex items-center gap-1">
                                                                            <div
                                                                                className={`historico-badge flex-1 ${!documento.historico ? 'empty' : ''}`}
                                                                                onClick={(e) => iniciarEdicao(documento, 'historico', documento.historico, 'historico', e)}
                                                                            >
                                                                                {documento.historico || 'Selecionar Histórico'}
                                                                            </div>
                                                                            {documento.historico && (
                                                                                <button
                                                                                    onClick={() => iniciarAutomacaoHistorico(documento.historico)}
                                                                                    className="text-purple-600 hover:text-purple-800 transition-colors"
                                                                                    title="Automatizar este histórico"
                                                                                >
                                                                                    <i className="fas fa-robot text-xs"></i>
                                                                                </button>
                                                                            )}
                                                                        </div>
                                                                    </td>

                                                                    {/* Confiança */}
                                                                    <td className="px-3 py-2 whitespace-nowrap">
                                                                        <span className={`text-xs font-medium ${getConfidenceColor(documento.confianca)}`}>
                                                                            {documento.confianca.toFixed(0)}%
                                                                        </span>
                                                                    </td>

                                                                    {/* Ações */}
                                                                    <td className="px-3 py-2 whitespace-nowrap">
                                                                        <button
                                                                            onClick={() => excluirDocumento(documento.id)}
                                                                            className="delete-btn"
                                                                            title="Excluir documento"
                                                                        >
                                                                            <i className="fas fa-trash text-xs"></i>
                                                                        </button>
                                                                    </td>
                                                                </tr>
                                                            ))}
                                                        </tbody>
                                                    </table>
                                                </div>
                                            )}

                                            {/* Dropdown para seleção de históricos (mantido para histórico) */}
                                            {showDropdown && dropdownType === 'historico' && (
                                                <div
                                                    ref={dropdownRef}
                                                    className="fixed z-50 dropdown-options"
                                                    style={{
                                                        left: dropdownPosition.x,
                                                        top: dropdownPosition.y,
                                                        minWidth: '400px',
                                                        maxWidth: '500px'
                                                    }}
                                                >
                                                    <div className="p-2 border-b border-gray-200">
                                                        <input
                                                            type="text"
                                                            placeholder="Pesquisar por código ou descrição..."
                                                            value={searchTerm}
                                                            onChange={(e) => setSearchTerm(e.target.value)}
                                                            className="search-input"
                                                            autoFocus
                                                        />
                                                    </div>
                                                    <div className="max-h-48 overflow-y-auto">
                                                        {historicosFiltrados.length === 0 ? (
                                                            <div className="p-3 text-center text-gray-500 text-xs">
                                                                Nenhum histórico encontrado. {historicoContas.length === 0 ? 'Cadastre ou importe históricos.' : 'Tente outro termo de pesquisa.'}
                                                            </div>
                                                        ) : (
                                                            historicosFiltrados.map((historico, index) => (
                                                                <div
                                                                    key={index}
                                                                    className="dropdown-option"
                                                                    onClick={() => selecionarHistorico(historico)}
                                                                >
                                                                    <div className="grid grid-cols-12 gap-1 text-xs">
                                                                        <div className="col-span-2 font-mono font-bold">
                                                                            {historico.codigo}
                                                                        </div>
                                                                        <div className="col-span-10 text-gray-600">
                                                                            {historico.descricao}
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            ))
                                                        )}
                                                    </div>
                                                    <div className="p-2 border-t border-gray-200 text-xs text-gray-500 bg-gray-50">
                                                        {historicosFiltrados.length} de {historicoContas.length} históricos
                                                    </div>
                                                </div>
                                            )}
                                        </div>
                                    )}

                                    {/* View: Upload de Documentos (mantido igual) */}
                                    {currentView === 'upload' && (
                                        <div className="space-y-6 fade-in">
                                            <div className="bg-gradient-to-r from-blue-500 to-purple-600 rounded-xl p-6 text-white">
                                                <div className="flex items-center gap-3 mb-2">
                                                    <i className="fas fa-robot text-2xl"></i>
                                                    <h2 className="text-xl font-bold">Reconhecimento de Documentos</h2>
                                                </div>
                                                <p className="text-blue-100">
                                                    Faça upload de PDFs ou imagens para extrair automaticamente informações contábeis.
                                                </p>
                                            </div>

                                            {/* Área de Upload */}
                                            <div className="bg-white border-2 border-dashed border-gray-300 rounded-xl p-8 text-center hover:border-blue-300 transition-colors">
                                                <input
                                                    type="file"
                                                    accept=".pdf,.jpg,.jpeg,.png"
                                                    onChange={handleFileUpload}
                                                    className="hidden"
                                                    id="file-upload"
                                                    disabled={isProcessingOCR}
                                                />
                                                <label
                                                    htmlFor="file-upload"
                                                    className={`cursor-pointer flex flex-col items-center justify-center gap-4 ${
                                                        isProcessingOCR ? 'opacity-50 cursor-not-allowed' : 'hover:text-blue-600'
                                                    }`}
                                                >
                                                    <i className="fas fa-file-upload text-4xl text-gray-400"></i>
                                                    <div>
                                                        <p className="text-lg font-semibold text-gray-700">
                                                            {isProcessingOCR ? 'Processando documento...' : 'Clique para selecionar um documento'}
                                                        </p>
                                                        <p className="text-sm text-gray-500 mt-1">
                                                            Suporta PDF, JPG, JPEG, PNG (máx. 10MB)
                                                        </p>
                                                    </div>
                                                </label>

                                                {isProcessingOCR && (
                                                    <div className="mt-6 space-y-3">
                                                        <div className="flex justify-between text-sm text-gray-600">
                                                            <span>Progresso do OCR</span>
                                                            <span>{ocrProgress}%</span>
                                                        </div>
                                                        <div className="w-full bg-gray-200 rounded-full h-3">
                                                            <div
                                                                className="h-3 rounded-full transition-all duration-500 bg-gradient-to-r from-blue-500 to-purple-600"
                                                                style={{ width: `${ocrProgress}%` }}
                                                            />
                                                        </div>
                                                        <p className="text-xs text-gray-500">
                                                            Analisando documento e extraindo informações...
                                                        </p>
                                                    </div>
                                                )}
                                            </div>

                                            {/* Botão para voltar à lista */}
                                            {documentos.length > 0 && (
                                                <div className="text-center">
                                                    <button
                                                        onClick={() => setCurrentView('documents')}
                                                        className="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg font-semibold flex items-center gap-2 mx-auto"
                                                    >
                                                        <i className="fas fa-list"></i>
                                                        Ver Documentos Processados ({documentos.length})
                                                    </button>
                                                </div>
                                            )}
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Modal de Geração de CTBIL (mantido igual) */}
                    {showCTBILModal && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 modal-overlay">
                            <div className="bg-white rounded-xl max-w-md w-full">
                                <div className="p-4 border-b border-gray-200">
                                    <div className="flex justify-between items-center">
                                        <h3 className="text-lg font-bold text-gray-800">Gerar Arquivo CTBIL</h3>
                                        <button
                                            onClick={() => setShowCTBILModal(false)}
                                            className="text-gray-400 hover:text-gray-600 transition"
                                        >
                                            <i className="fas fa-times"></i>
                                        </button>
                                    </div>
                                </div>
                                
                                <div className="p-4 space-y-4">
                                    <div className="text-sm text-gray-600">
                                        <p>Configure os parâmetros para geração do arquivo CTBIL:</p>
                                    </div>

                                    <div className="space-y-3">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">
                                                Código da Empresa
                                            </label>
                                            <input
                                                type="text"
                                                value={configCTBIL.codigoEmpresa}
                                                onChange={(e) => setConfigCTBIL(prev => ({...prev, codigoEmpresa: e.target.value}))}
                                                className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"
                                                placeholder="Nome da empresa"
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">
                                                Número do Lote
                                            </label>
                                            <input
                                                type="text"
                                                value={configCTBIL.numeroLote}
                                                onChange={(e) => setConfigCTBIL(prev => ({...prev, numeroLote: e.target.value}))}
                                                className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"
                                                placeholder="000001"
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">
                                                Data do Arquivo
                                            </label>
                                            <input
                                                type="date"
                                                value={configCTBIL.dataFinal}
                                                onChange={(e) => setConfigCTBIL(prev => ({...prev, dataFinal: e.target.value}))}
                                                className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"
                                            />
                                        </div>

                                        <div className="grid grid-cols-2 gap-3">
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">
                                                    Filial Débito
                                                </label>
                                                <input
                                                    type="text"
                                                    value={configCTBIL.filialDebito}
                                                    onChange={(e) => setConfigCTBIL(prev => ({...prev, filialDebito: e.target.value}))}
                                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"
                                                    placeholder="00"
                                                    maxLength="2"
                                                />
                                            </div>
                                            
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">
                                                    Filial Crédito
                                                </label>
                                                <input
                                                    type="text"
                                                    value={configCTBIL.filialCredito}
                                                    onChange={(e) => setConfigCTBIL(prev => ({...prev, filialCredito: e.target.value}))}
                                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"
                                                    placeholder="00"
                                                    maxLength="2"
                                                />
                                            </div>
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">
                                                Centro de Custo
                                            </label>
                                            <input
                                                type="text"
                                                value={configCTBIL.centroCusto}
                                                onChange={(e) => setConfigCTBIL(prev => ({...prev, centroCusto: e.target.value}))}
                                                className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"
                                                placeholder="0000"
                                                maxLength="4"
                                            />
                                        </div>
                                    </div>

                                    <div className="bg-blue-50 p-3 rounded-lg">
                                        <h4 className="font-semibold text-blue-800 text-sm mb-2">Resumo</h4>
                                        <div className="text-xs text-blue-700 space-y-1">
                                            <div className="flex justify-between">
                                                <span>Total de documentos:</span>
                                                <span>{documentos.length}</span>
                                            </div>
                                            <div className="flex justify-between">
                                                <span>Prontos para CTBIL:</span>
                                                <span className="font-semibold">
                                                    {documentos.filter(d => d.contaDebito && d.contaCredito && d.valor).length}
                                                </span>
                                            </div>
                                            <div className="flex justify-between">
                                                <span>Pendentes:</span>
                                                <span className="text-orange-600">
                                                    {documentos.filter(d => !d.contaDebito || !d.contaCredito || !d.valor).length}
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div className="p-4 border-t border-gray-200 flex gap-2">
                                    <button
                                        onClick={() => setShowCTBILModal(false)}
                                        className="flex-1 bg-gray-200 text-gray-700 px-3 py-2 rounded-lg text-sm card-hover transition"
                                    >
                                        Cancelar
                                    </button>
                                    <button
                                        onClick={gerarCTBIL}
                                        className="flex-1 bg-orange-600 hover:bg-orange-700 text-white px-3 py-2 rounded-lg text-sm card-hover transition"
                                    >
                                        <i className="fas fa-download mr-1"></i>
                                        Gerar CTBIL
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Modal de Importação do Plano de Contas (mantido igual) */}
                    {showImportModal && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 modal-overlay">
                            <div className="bg-white rounded-xl max-w-6xl w-full max-h-[90vh] overflow-hidden">
                                <div className="p-4 border-b border-gray-200">
                                    <div className="flex justify-between items-center">
                                        <h3 className="text-lg font-bold text-gray-800">Importar Plano de Contas</h3>
                                        <button
                                            onClick={() => setShowImportModal(false)}
                                            className="text-gray-400 hover:text-gray-600 transition"
                                        >
                                            <i className="fas fa-times"></i>
                                        </button>
                                    </div>
                                </div>
                                
                                <div className="p-4 space-y-4 overflow-y-auto max-h-[70vh]">
                                    <div className="text-sm text-gray-600">
                                        <p>Formato do arquivo Excel obrigatório:</p>
                                        <ul className="list-disc list-inside mt-2 space-y-1">
                                            <li><strong>Coluna A:</strong> Código Reduzido</li>
                                            <li><strong>Coluna B:</strong> Conta</li>
                                            <li><strong>Coluna C:</strong> Descrição</li>
                                        </ul>
                                    </div>

                                    {/* Área de Upload Compacta */}
                                    <div className="compact-upload-area border-2 border-dashed border-gray-300 rounded-lg text-center">
                                        <input
                                            type="file"
                                            accept=".xlsx,.xls"
                                            onChange={importarPlanoContas}
                                            className="hidden"
                                            id="plano-contas-upload"
                                        />
                                        <label
                                            htmlFor="plano-contas-upload"
                                            className="cursor-pointer flex flex-col items-center justify-center gap-2 py-4 hover:text-blue-600"
                                        >
                                            <i className="fas fa-file-excel text-3xl text-green-600"></i>
                                            <p className="font-semibold text-gray-700">Clique para selecionar o arquivo Excel</p>
                                            <p className="text-xs text-gray-500">.xlsx ou .xls</p>
                                        </label>
                                    </div>

                                    {/* Formulário para adicionar conta manualmente */}
                                    <div className="bg-gray-50 p-4 rounded-lg">
                                        <h4 className="font-semibold text-gray-700 mb-3">Adicionar Conta Manualmente</h4>
                                        <div className="grid grid-cols-12 gap-3">
                                            <div className="col-span-3">
                                                <input
                                                    type="text"
                                                    id="nova-conta-codigo"
                                                    placeholder="Código Reduzido"
                                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"
                                                />
                                            </div>
                                            <div className="col-span-3">
                                                <input
                                                    type="text"
                                                    id="nova-conta-numero"
                                                    placeholder="Número da Conta"
                                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"
                                                />
                                            </div>
                                            <div className="col-span-4">
                                                <input
                                                    type="text"
                                                    id="nova-conta-descricao"
                                                    placeholder="Descrição da Conta"
                                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"
                                                />
                                            </div>
                                            <div className="col-span-2">
                                                <button
                                                    onClick={adicionarConta}
                                                    className="w-full bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded-lg text-sm"
                                                >
                                                    Adicionar
                                                </button>
                                            </div>
                                        </div>
                                    </div>

                                    {/* Lista de contas importadas com opções de editar/excluir */}
                                    {planoContas.length > 0 && (
                                        <div>
                                            <div className="flex justify-between items-center mb-3">
                                                <h4 className="font-semibold text-gray-700">
                                                    Contas Importadas ({planoContas.length})
                                                </h4>
                                                <div className="flex items-center gap-2">
                                                    <input
                                                        type="text"
                                                        placeholder="Buscar contas..."
                                                        value={searchTerm}
                                                        onChange={(e) => setSearchTerm(e.target.value)}
                                                        className="search-input"
                                                        style={{width: '200px', marginBottom: 0}}
                                                    />
                                                    <label className="flex items-center gap-2 text-xs">
                                                        <input
                                                            type="checkbox"
                                                            checked={mostrarApenasAnaliticas}
                                                            onChange={(e) => setMostrarApenasAnaliticas(e.target.checked)}
                                                            className="rounded"
                                                        />
                                                        Apenas analíticas
                                                    </label>
                                                </div>
                                            </div>
                                            
                                            <div className="overflow-y-auto max-h-64">
                                                <table className="min-w-full divide-y divide-gray-200 text-sm">
                                                    <thead className="bg-gray-100">
                                                        <tr>
                                                            <th className="px-3 py-2 text-left text-xs font-medium uppercase tracking-wider">
                                                                Código Reduzido
                                                            </th>
                                                            <th className="px-3 py-2 text-left text-xs font-medium uppercase tracking-wider">
                                                                Conta
                                                            </th>
                                                            <th className="px-3 py-2 text-left text-xs font-medium uppercase tracking-wider">
                                                                Descrição
                                                            </th>
                                                            <th className="px-3 py-2 text-left text-xs font-medium uppercase tracking-wider">
                                                                Tipo
                                                            </th>
                                                            <th className="px-3 py-2 text-left text-xs font-medium uppercase tracking-wider">
                                                                Ações
                                                            </th>
                                                        </tr>
                                                    </thead>
                                                    <tbody className="bg-white divide-y divide-gray-200">
                                                        {contasFiltradas.map((conta, index) => (
                                                            <tr key={index}>
                                                                <td className="px-3 py-2 whitespace-nowrap text-xs">
                                                                    {editingConta && editingConta.codigoReduzido === conta.codigoReduzido ? (
                                                                        <input
                                                                            type="text"
                                                                            value={editContaValue.codigoReduzido}
                                                                            onChange={(e) => setEditContaValue(prev => ({...prev, codigoReduzido: e.target.value}))}
                                                                            className="border border-gray-300 rounded px-2 py-1 text-xs w-full"
                                                                        />
                                                                    ) : (
                                                                        conta.codigoReduzido
                                                                    )}
                                                                </td>
                                                                <td className="px-3 py-2 whitespace-nowrap text-xs">
                                                                    {editingConta && editingConta.codigoReduzido === conta.codigoReduzido ? (
                                                                        <input
                                                                            type="text"
                                                                            value={editContaValue.conta}
                                                                            onChange={(e) => setEditContaValue(prev => ({...prev, conta: e.target.value}))}
                                                                            className="border border-gray-300 rounded px-2 py-1 text-xs w-full"
                                                                        />
                                                                    ) : (
                                                                        conta.conta
                                                                    )}
                                                                </td>
                                                                <td className="px-3 py-2 text-xs">
                                                                    {editingConta && editingConta.codigoReduzido === conta.codigoReduzido ? (
                                                                        <input
                                                                            type="text"
                                                                            value={editContaValue.descricao}
                                                                            onChange={(e) => setEditContaValue(prev => ({...prev, descricao: e.target.value}))}
                                                                            className="border border-gray-300 rounded px-2 py-1 text-xs w-full"
                                                                        />
                                                                    ) : (
                                                                        conta.descricao
                                                                    )}
                                                                </td>
                                                                <td className="px-3 py-2 whitespace-nowrap text-xs">
                                                                    {isContaAnalitica(conta.conta) ? (
                                                                        <span className="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                                                            Analítica
                                                                        </span>
                                                                    ) : (
                                                                        <span className="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                                                                            Sintética
                                                                        </span>
                                                                    )}
                                                                </td>
                                                                <td className="px-3 py-2 whitespace-nowrap">
                                                                    <div className="flex space-x-1">
                                                                        {editingConta && editingConta.codigoReduzido === conta.codigoReduzido ? (
                                                                            <>
                                                                                <button 
                                                                                    onClick={editarConta}
                                                                                    className="edit-btn"
                                                                                    title="Salvar"
                                                                                >
                                                                                    <i className="fas fa-check text-xs"></i>
                                                                                </button>
                                                                                <button 
                                                                                    onClick={() => setEditingConta(null)}
                                                                                    className="delete-btn"
                                                                                    title="Cancelar"
                                                                                >
                                                                                    <i className="fas fa-times text-xs"></i>
                                                                                </button>
                                                                            </>
                                                                        ) : (
                                                                            <>
                                                                                <button 
                                                                                    onClick={() => iniciarEdicaoConta(conta)}
                                                                                    className="edit-btn"
                                                                                    title="Editar"
                                                                                >
                                                                                    <i className="fas fa-edit text-xs"></i>
                                                                                </button>
                                                                                <button 
                                                                                    onClick={() => excluirConta(conta.codigoReduzido)}
                                                                                    className="delete-btn"
                                                                                    title="Excluir"
                                                                                >
                                                                                    <i className="fas fa-trash text-xs"></i>
                                                                                </button>
                                                                            </>
                                                                        )}
                                                                    </div>
                                                                </td>
                                                            </tr>
                                                        ))}
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    )}
                                </div>
                                
                                <div className="p-4 border-t border-gray-200">
                                    <button
                                        onClick={() => setShowImportModal(false)}
                                        className="w-full bg-gray-200 text-gray-700 px-3 py-2 rounded-lg text-sm card-hover transition"
                                    >
                                        Fechar
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Modal de Cadastro de Históricos (mantido igual) */}
                    {showHistoricoModal && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 modal-overlay">
                            <div className="bg-white rounded-xl max-w-4xl w-full max-h-[90vh] overflow-hidden">
                                <div className="p-4 border-b border-gray-200">
                                    <div className="flex justify-between items-center">
                                        <h3 className="text-lg font-bold text-gray-800">Cadastro de Históricos</h3>
                                        <button
                                            onClick={() => setShowHistoricoModal(false)}
                                            className="text-blue-600 hover:text-blue-800 transition"
                                        >
                                            <i className="fas fa-times"></i>
                                        </button>
                                    </div>
                                </div>
                                
                                <div className="p-4 space-y-4 overflow-y-auto max-h-[70vh]">
                                    {/* Formulário de cadastro manual */}
                                    <div className="bg-gray-50 p-4 rounded-lg">
                                        <h4 className="font-semibold text-gray-700 mb-3">Adicionar Histórico Manualmente</h4>
                                        <div className="grid grid-cols-12 gap-3">
                                            <div className="col-span-2">
                                                <input
                                                    type="text"
                                                    id="novo-codigo"
                                                    value={getProximoCodigo()}
                                                    disabled
                                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm bg-gray-100"
                                                />
                                            </div>
                                            <div className="col-span-8">
                                                <input
                                                    type="text"
                                                    id="nova-descricao"
                                                    placeholder="Descrição do histórico"
                                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"
                                                />
                                            </div>
                                            <div className="col-span-2">
                                                <button
                                                    onClick={adicionarHistorico}
                                                    className="w-full bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded-lg text-sm"
                                                >
                                                    Adicionar
                                                </button>
                                            </div>
                                        </div>
                                    </div>

                                    {/* Importação de Excel - Compactada */}
                                    <div className="compact-upload-area border-2 border-dashed border-gray-300 rounded-lg text-center">
                                        <input
                                            type="file"
                                            accept=".xlsx,.xls"
                                            onChange={importarHistoricoContas}
                                            className="hidden"
                                            id="historico-upload"
                                        />
                                        <label
                                            htmlFor="historico-upload"
                                            className="cursor-pointer flex flex-col items-center justify-center gap-2 py-4 hover:text-blue-600"
                                        >
                                            <i className="fas fa-file-excel text-3xl text-green-600"></i>
                                            <p className="font-semibold text-gray-700">Importar Históricos do Excel</p>
                                            <p className="text-xs text-gray-500">Coluna A: Código, Coluna B: Descrição</p>
                                        </label>
                                    </div>

                                    {/* Lista de históricos cadastrados com opções de editar/excluir */}
                                    <div>
                                        <div className="flex justify-between items-center mb-3">
                                            <h4 className="font-semibold text-gray-700">
                                                Históricos Cadastrados ({historicoContas.length})
                                            </h4>
                                            <div className="flex gap-2">
                                                <input
                                                    type="text"
                                                    placeholder="Buscar históricos..."
                                                    value={searchTerm}
                                                    onChange={(e) => setSearchTerm(e.target.value)}
                                                    className="search-input"
                                                    style={{width: '200px', marginBottom: 0}}
                                                />
                                                <button
                                                    onClick={exportarHistoricosExcel}
                                                    className="bg-green-600 hover:bg-green-700 text-white px-3 py-1.5 rounded-lg flex items-center gap-2 text-xs"
                                                >
                                                    <i className="fas fa-file-excel"></i>
                                                    Exportar Excel
                                                </button>
                                            </div>
                                        </div>
                                        {historicoContas.length === 0 ? (
                                            <div className="text-center py-8 text-gray-500">
                                                <i className="fas fa-history text-3xl mb-3 text-gray-300"></i>
                                                <p className="text-sm">Nenhum histórico cadastrado</p>
                                                <p className="text-xs">Adicione manualmente ou importe do Excel</p>
                                            </div>
                                        ) : (
                                            <div className="overflow-y-auto max-h-64">
                                                <table className="min-w-full divide-y divide-gray-200 text-sm">
                                                    <thead className="bg-gray-100">
                                                        <tr>
                                                            <th className="px-3 py-2 text-left text-xs font-medium uppercase tracking-wider">
                                                                Código
                                                            </th>
                                                            <th className="px-3 py-2 text-left text-xs font-medium uppercase tracking-wider">
                                                                Descrição
                                                            </th>
                                                            <th className="px-3 py-2 text-left text-xs font-medium uppercase tracking-wider">
                                                                Ações
                                                            </th>
                                                        </tr>
                                                    </thead>
                                                    <tbody className="bg-white divide-y divide-gray-200">
                                                        {historicosFiltrados.map((historico, index) => (
                                                            <tr key={index}>
                                                                <td className="px-3 py-2 whitespace-nowrap font-mono text-xs">
                                                                    {historico.codigo}
                                                                </td>
                                                                <td className="px-3 py-2 text-xs">
                                                                    {editingHistorico && editingHistorico.codigo === historico.codigo ? (
                                                                        <input
                                                                            type="text"
                                                                            value={editHistoricoValue}
                                                                            onChange={(e) => setEditHistoricoValue(e.target.value)}
                                                                            className="border border-gray-300 rounded px-2 py-1 text-xs w-full"
                                                                        />
                                                                    ) : (
                                                                        historico.descricao
                                                                    )}
                                                                </td>
                                                                <td className="px-3 py-2 whitespace-nowrap">
                                                                    <div className="flex space-x-1">
                                                                        {editingHistorico && editingHistorico.codigo === historico.codigo ? (
                                                                            <>
                                                                                <button 
                                                                                    onClick={editarHistorico}
                                                                                    className="edit-btn"
                                                                                    title="Salvar"
                                                                                >
                                                                                    <i className="fas fa-check text-xs"></i>
                                                                                </button>
                                                                                <button 
                                                                                    onClick={() => setEditingHistorico(null)}
                                                                                    className="delete-btn"
                                                                                    title="Cancelar"
                                                                                >
                                                                                    <i className="fas fa-times text-xs"></i>
                                                                                </button>
                                                                            </>
                                                                        ) : (
                                                                            <>
                                                                                <button 
                                                                                    onClick={() => iniciarEdicaoHistorico(historico)}
                                                                                    className="edit-btn"
                                                                                    title="Editar"
                                                                                >
                                                                                    <i className="fas fa-edit text-xs"></i>
                                                                                </button>
                                                                                <button 
                                                                                    onClick={() => excluirHistorico(historico.codigo)}
                                                                                    className="delete-btn"
                                                                                    title="Excluir"
                                                                                >
                                                                                    <i className="fas fa-trash text-xs"></i>
                                                                                </button>
                                                                            </>
                                                                        )}
                                                                    </div>
                                                                </td>
                                                            </tr>
                                                        ))}
                                                    </tbody>
                                                </table>
                                            </div>
                                        )}
                                    </div>
                                </div>
                                
                                <div className="p-4 border-t border-gray-200">
                                    <button
                                        onClick={() => setShowHistoricoModal(false)}
                                        className="w-full bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded-lg text-sm card-hover transition"
                                    >
                                        Fechar
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Modal de Edição de Campos (mantido igual) */}
                    {showEditModal && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 modal-overlay">
                            <div className="bg-white rounded-xl small-modal">
                                <div className="p-4 border-b border-gray-200">
                                    <div className="flex justify-between items-center">
                                        <h3 className="text-lg font-bold text-gray-800">
                                            Editar {editingCell?.campo === 'cpfCnpj' ? 'CPF/CNPJ' : 
                                                   editingCell?.campo === 'valor' ? 'Valor' : 
                                                   editingCell?.campo === 'dataVencimento' ? 'Data Vencimento' : 
                                                   editingCell?.campo === 'beneficiario' ? 'Beneficiário' : 
                                                   editingCell?.campo === 'pagador' ? 'Pagador' : 'Campo'}
                                        </h3>
                                        <button
                                            onClick={() => setShowEditModal(false)}
                                            className="text-gray-400 hover:text-gray-600 transition"
                                        >
                                            <i className="fas fa-times"></i>
                                        </button>
                                    </div>
                                </div>
                                
                                <div className="p-4">
                                    <input
                                        type="text"
                                        value={editValue}
                                        onChange={(e) => setEditValue(e.target.value)}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"
                                        autoFocus
                                        onKeyPress={(e) => e.key === 'Enter' && salvarEdicaoModal()}
                                    />
                                </div>
                                
                                <div className="p-4 border-t border-gray-200 flex gap-2">
                                    <button
                                        onClick={() => setShowEditModal(false)}
                                        className="flex-1 bg-gray-200 text-gray-700 px-3 py-2 rounded-lg text-sm card-hover transition"
                                    >
                                        Cancelar
                                    </button>
                                    <button
                                        onClick={salvarEdicaoModal}
                                        className="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded-lg text-sm card-hover transition"
                                    >
                                        Salvar
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Modal de Seleção de Conta - AJUSTADO */}
                    <ContaModal />

                    {/* Modal de Informações do Sistema */}
                    <InfoModal />

                    {/* Modal de Processamento de Extratos */}
                    <ExtratoModal />

                    {/* Modal de Automação de Históricos */}
                    <AutomacaoModal />

                    {/* Modal de Exclusão em Massa */}
                    <DeleteModal />
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('app'));
    </script>
</body>
</html>